<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>自动压位参数</title>
    <script src="../vue/vue.js"></script>
    <link rel="stylesheet" href="../resource/iview-2.0/dist/styles/iview.css">
    <!--<link rel="stylesheet" href="../resource/iview/iviewCss.css">-->
    <!--<link rel="stylesheet" href="//unpkg.com/iview/dist/styles/iview.css">-->
    <link rel="stylesheet" href="../resource/css/tableCustom.css">

    <style type="text/css">
        .tableDiv{
            /*overflow: scroll;*/
            /*overflow-x: scroll;*/
        }
        /*搜索样式*/
        #findWind{
            width: 900px;
            margin: 10px;
            margin-left: 100px;
            display: flex;
            flex-wrap:wrap;
            /*justify-content: space-around;*/
            align-items: center;
        }
        #findWind>div{
            margin: 10px 10px 5px 0px;
        }
        #findWind>div>select{
            width: 150px;
            border: 1px solid #dcdee2;
            height: 27px;
            border-radius: 3px;
        }
        #findWind>div>input{
            width: 150px;
            border: 1px solid #dcdee2;
            height: 27px;
            border-radius: 3px;
        }
        /*table最上面一排操作按钮*/
        #handlebut{
            display: flex;
        }
        #handlebut>*{
            margin-left: 15px;
        }
        /*处理组件样式*/
        #dealpol{
            position: absolute;
            top: 40px;
            /*left: 15%;*/
            left: 150px;
            width: 800px;
            margin-bottom: 30px;
            box-shadow: 0px 0px 2px 0px black;
            background-color: white;
            z-index: 2
        }
        #dealpol>div{
            margin: 7px;
            display: flex;
            align-items: center;
        }
        .dealHeader{
            display: flex;
            height: 30px;
            width: 100%;
            /*flex: 2 1 auto;*/
            /*text-align: center;*/
            line-height: 30px;
            border-bottom: 1px silver solid;
            justify-content: center;
        }
        .dealHeader>div{
            font-size: 18px;
            width: 100px;
            text-align: justify;
        }
        .dealHeader>div:after{
            width: 100%;
            content: '';
            display: inline-block;

        }
        .minTitle{
            width: 100px;
            display: inline-block;
        }
        /*批量修改样式*/
        #lotSizeChangeWindow{
            position: absolute;
            top: 40px;
            /*left: 15%;*/
            left: 150px;
            width: 800px;
            box-shadow: 0px 0px 2px 0px black;
            background-color: white;
            z-index: 2;
            padding: 5px;
        }
        #lotSizeChangeWindow>div{
            margin-top: 5px;
        }
        /*批量勾选平台input样式*/
        .plateCheckedDiv{
            display: flex;
            flex-wrap: wrap;
        }
        .plateChecked{
            width: 75px;
            /*margin-right: 5px;*/
        }
        /*生效*/
        tr[data-lin='1']{}
        /*过期*/
        tr[data-lin='2']{
            background-color: rgba(255,163,0,0.2);
        }
        /*不生效*/
        tr[data-lin='0']{
            /*给字体加中间线*/
            /*text-decoration:line-through;*/
            /*text-decoration-color:red;*/
            color:red;
            /*划线颜色一定要放到添加划线样式的下面*/
        }
        .page{
            margin:10px;
            float:right;
        }
        .red{
            color: red;
        }
        .ivu-radio-wrapper.ivu-radio-group-item.ivu-radio-default{
            margin-top: 8px;
        }
    </style>
</head>
<body>
<div id="VuePolicy">
    <find-Window v-if="findFlag"></find-Window>
    <policy ref="policyTable"></policy>
    <deal-policy v-if="dealPolicy"></deal-policy>
    <lot-size-change v-if="lotSizeFlag"></lot-size-change>
</div>
<!--查询框-->
<template id="findWindow">
    <div id="findWind">
        <!--政策编号-->
        <div>
            <span>政策编号</span>
            <input type="text" v-model="policyCode">
        </div>
        <!--出票方式-->
        <div>
            <span>出票方式</span>
            <Select v-model="picketMethods" filterable style="width:150px">
                <Option v-for="item in pay_type" :value="item.value" :key="item.value">{{ item.label }}</Option>
            </Select>
        </div>
        <!--政策适用对象-->
        <div>
            <span>适用对象</span>
            <Select v-model="suitableObj" filterable style="width:150px">
                <Option v-for="item in plattform" :value="item.value" :key="item.value">{{ item.label }}</Option>
            </Select>
        </div>
        <!--日期-->
        <div>
            <span>航班日期</span>
            <date-picker type="daterange"
                         split-panels
                         placement="bottom-end"
                         placeholder="Select date"
                         style="width: 200px"
                         @on-change="handleChange"
                         :value="dateValue"
            ></date-picker>
        </div>
        <!--乘客类型-->
        <div>
            <span>乘客类型</span>
            <select v-model="passenger_type" filterable style="width:150px">
                <option value="0">适应全部</option>
                <option value="1">成人</option>
                <option value="2">儿童</option>
            </select>
        </div>
        <!--航空公司-->
        <div>
            <span>航空公司</span>
            <Select v-model="airline" filterable style="width:150px">
                <Option v-for="item in plattform" :value="item.value" :key="item.value">{{ item.label }}</Option>
            </Select>
        </div>
        <!--出发城市-->
        <div>
            <span>出发城市</span>
            <input type="text" v-model="dpt_city">
        </div>
        <!--到达城市-->
        <div>
            <span>到达城市</span>
            <input type="text" v-model="arr_city">

        </div>
        <button @click="findFun">查询</button>
    </div>
</template>
<!--主体展示table-->
<template id="table-div-dom">
    <div>
        <div class="tableDiv">
            <div id="handlebut">
                <div>
                    <span>全选</span>
                </div>
                <div>
                    <radio-group @on-change="ThreeRadioFun">
                        <Radio label="all">
                            <span>全部</span>
                        </Radio>
                        <Radio label="no" >
                            <span>无效</span>
                        </Radio>
                        <Radio label="ok">
                            <span>有效</span>
                        </Radio>
                    </radio-group>
                </div>
                <button class="butt" style="margin: 0px 30px 0px 30px;cursor: pointer" @click="findshow">
                    <span>查询框</span>
                </button>
                <button class="butt" @click="newAdd">新增</button>
                <!--<button class="butt" @click="changePolicy">修改</button>-->
                <button class="butt" @click="copyFun">复制</button>
                <button class="butt" @click="lotChange">批量修改</button>
                <button class="butt" @click="logDelet">批量删除</button>
            </div>
            <table style="width: 100%">
                <colgroup>
                    <col width="50px"> <!--序号-->
                    <col width="40px"> <!--航司-->
                    <col width="60px"> <!--出票类型-->
                    <col width="65px"> <!--乘客类型-->
                    <col width="80px"> <!--适应乘客人数-->
                    <col width="60px"> <!--账户-->
                    <col width="60px"> <!--出发城市-->
                    <col width="60px"> <!--到达城市-->
                    <col width="70px"> <!--适用仓位-->
                    <col width="90px"> <!--最大亏损-->
                    <col width="auto"> <!--票价范围-->
                    <col width="auto"> <!--适用平台-->
                    <col width="auto"> <!--起飞时段-->
                    <col width="auto"> <!--出票时段-->
                    <col width="auto"> <!--发布人-->
                    <col width="auto"> <!--是否生效-->
                    <col width="auto"> <!--状态设置-->
                </colgroup>
                <thead>
                <tr class="TableHead">
                    <th style="width: 40px">
                        <input type="checkbox" @click="allInput" id="inputAllDom">
                        序号</th>
                    <th>航司</th>
                    <th>出票类型</th>
                    <th>乘客类型</th>
                    <th>适应乘客人数</th>
                    <th>账户</th>
                    <th>出发城市</th>
                    <th>到达城市</th>
                    <th>适用仓位</th>
                    <th>最大亏损/返点</th>
                    <th>票价范围</th>
                    <th>行程</th>
                    <th>适用平台</th>
                    <th>起飞时段</th>
                    <th>出票时段</th>
                    <th>发布人</th>
                    <th>是否生效</th>
                    <th>状态设置</th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="(ele,index) in tableObj" :key="ele.id" :data-lin="ele.is_effective">
                    <!--序号-->
                    <td>
                        <input type="checkbox" @click="addId(ele.id)" ref="inputDom">
                        {{ele.id}}
                    </td>
                    <!--航司-->
                    <td>
                        <div>{{ele.airline}}</div>
                    </td>
                    <!--出票类型-->
                    <td>{{ele.ticket_username | tickType}}</td>
                    <!--乘客类型-->
                    <td>
                        <div v-if="ele.passenger_type==0">全部</div>
                        <div v-else-if="ele.passenger_type==1">成人</div>
                        <div v-else="ele.passenger_type==2">儿童</div>
                    </td>
                    <!--适应乘客人数-->
                    <td>
                        <span>{{ele.passenger_num_min}}</span>
                        <span>-</span>
                        <span>{{ele.passenger_num_max}}</span>
                    </td>
                    <!--账户-->
                    <td>{{ele.ticket_username | tickAccount}}</td>
                    <!--出发城市-->
                    <td>{{ele.dpt_city}}</td>
                    <!--到达城市-->
                    <td>{{ele.arr_city}}</td>
                    <!--适用仓位-->
                    <td :title="ele.position">
                        <div style="width: 100px;overflow: hidden;margin: 0 auto">{{ele.position}}</div>
                    </td>
                    <!--&lt;!&ndash;投放方式&ndash;&gt;-->
                    <!--<td>xxx</td>-->
                    <!--最大亏损-->
                    <td>
                        <div v-if="ele.loss!=null">{{ele.loss}}</div>
                        <div v-else="ele.rebate!=null">{{ele.rebate}}</div>
                    </td>
                    <!--票价范围-->
                    <td>{{ele.fare_root | fare_rootFilter}}</td>
                    <!--行程-->
                    <td>
                        <div v-if="ele.stroke_type==0">单程</div>
                        <div v-else-if="ele.stroke_type==1">往返</div>
                        <div v-else="ele.stroke_type==2">全部</div>
                    </td>
                    <!--适用平台-->
                    <td>
                        <div>{{ele.plattform | platform}}</div>
                        <!--<div>{{ele.plattform}}</div>-->
                    </td>
                    <!--起飞时段-->
                    <td>
                        <div>{{ele.fly_date_min}}</div>
                        <div>{{ele.fly_date_max}}</div>
                    </td>
                    <!--出票时段-->
                    <td>
                        <div>{{ele.ticket_date_min}}</div>
                        <div>{{ele.ticket_date_max}}</div>
                    </td>
                    <!--发布人-->
                    <td>{{}}</td>
                    <!--是否生效-->
                    <td>{{ele.is_effective | is_effectiveFun}}</td>
                    <!--状态设置-->
                    <td>
                        <button @click="changePolicy(ele.id)" class="butt">修改</button>
                        <button @click="disable(ele.id)" class="butt" v-if="ele.is_effective==1">禁用</button>
                        <button @click="enable(ele.id)" class="butt" v-else-if="ele.is_effective==0">启用</button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <!--分页逻辑-->
        <div  class="page">
            <div>
                <button @click="firstpage">首页</button>
                <button @click="uppage">上一页</button>
                共<span>{{pages}}</span>页&nbsp;&nbsp;
                第&nbsp;<input type="text" style="width:40px;height:22px;padding:5px;display: inline;font-size: .9em;" id="apage" v-model="num" ref="num" @click="saveNum(num)">&nbsp;页&nbsp;&nbsp;
                <button type="button" title="确定"  @click="gotopage">转到</button>
                <button @click="downpage">下一页</button>
                <button @click="lastpage">末页</button>
            </div>
        </div>
    </div>
</template>
<!--处理弹窗-->
<template id="dealPolicy">
    <div id="dealpol">
        <header class="dealHeader">
            <div>修改政策</div>
            <i-button  size="small" shape="circle" style="position: absolute;right: 5px;top: 3px;font-weight: bold;" @click="dealPolicyClose">X</i-button>
        </header>
        <!--行程类别-->
        <div>
            <div style="display: inline-block;text-align: justify;width: 66px">行程类别&#8194;：</div>
            <radio-group v-model="policyObj.stroke_type">
                <Radio label="0">
                    <span>单程</span>
                </Radio>
                <Radio label="1">
                    <span>往返程</span>
                </Radio>
                <Radio label='2'>
                    <span>单程或往返程</span>
                </Radio>
            </radio-group>
        </div>
        <!--乘客类型-->
        <div>
            <span class="red">*</span>
            <span>乘客类型：</span>
            <radio-group v-model="policyObj.passenger_type">
                <Radio label=1>
                    <span>成人</span>
                </Radio>
                <Radio label=2>
                    <span>儿童</span>
                </Radio>
                <Radio label=0>
                    <span>适应全部</span>
                </Radio>
            </radio-group>
        </div>
        <!--适应乘客人数-->
        <div style="display: flex">
            <span class="red">*</span>
            <span>适应乘客人数：</span>
            <div>
                <i-input style="width: 150px" v-model.trim="policyObj.passenger_num_min">
                    <span slot="prepend">大于等于</span>
                </i-input>
            </div>
            <div>
                <i-input style="width: 150px" v-model.trim="policyObj.passenger_num_max">
                    <span slot="prepend">小于等于</span>
                </i-input>
            </div>
        </div>
        <!--选择航空公司-->
        <div>
            <span>选择航空公司&#8194;：</span>
            <select  size="small" style="width:100px" @click="ceshi" v-model="policyObj.airline">
                <option v-for="item in airline" :value="item" :key="item">{{item}}</option>
            </select>
        </div>
        <!--出发城市-->
        <div>
            <i-input style="width: 300px" v-model.trim="policyObj.dpt_city">
                <span slot="prepend">出发城市</span>
            </i-input>
        </div>
        <!--到达城市-->
        <div>
            <i-input style="width: 300px" v-model.trim="policyObj.arr_city">
                <span slot="prepend">到达城市</span>
            </i-input>
        </div>
        <!--确定适用航班-->
        <div>
            <span class="red">*</span>
            <span>确定适用航班：</span>
            <radio-group v-model="flight">
                <Radio label="2">
                    <span>适用全部</span>
                </Radio>
                <Radio label="1">
                    <span>适用</span>
                </Radio>
                <Radio label="0">
                    <span>不适用</span>
                </Radio>
            </radio-group>
            <div>
                <i-input style="width: 300px" v-model.trim="flightText">
                    <span slot="prepend">适用或不适用航班</span>
                </i-input>
            </div>
        </div>
        <!--适用仓位-->
        <div>
            <span class="red">*</span>
            <span>适用仓位：</span>
            <div >
                <Checkbox
                        :indeterminate="indeterminate"
                        :value="checkAll"
                        @click.prevent.native="handleCheckAll">全选</Checkbox>
            </div>
            <Checkbox-group v-model="policyObj.position" @on-change="checkAllGroupChange">
                <Checkbox v-for="(ele,index) in position" :label="ele" :key="ele">{{ele}}</Checkbox>
            </Checkbox-group>
        </div>
        <!--起飞日期-->
        <div>
            <span>起飞日期：</span>
            <date-picker type="daterange" @on-change="timeFly" v-model="policyObj.fly_date" split-panels placeholder="Select date" placement="bottom-end" placeholder="Select date" style="width: 200px"></date-picker>
        </div>
        <!--出票日期-->
        <div>
            <span>出票日期：</span>
            <date-picker type="daterange" @on-change="timeTicket" v-model="policyObj.ticket_date" split-panels placeholder="Select date" placement="bottom-end" placeholder="Select date" style="width: 200px"></date-picker>
        </div>
        <!--最大亏损-->
        <div>
            <label style="margin-right: 20px"><input type="radio" value="loss"  v-model="loss"  ><span>最大亏损</span></label>
            <label style="margin-right: 20px"><input type="radio" value="rebate" v-model="loss"  ><span>最大亏损返点</span></label>
            <i-input style="width: 200px" v-model.trim="lossInputValue">
                <span slot="prepend">最大亏损(+/-)</span>
            </i-input>

        </div>
        <!--进单编码-->
        <div>
            <span>进单编码&#8194;：</span>
            <select  size="small" style="width:100px" v-model="policyObj.code">
                <option value="CSX513" >CSX513</option>
                <option value="CSX107" >CSX107</option>
                <option value="CSX127" >CSX127</option>
            </select>
        </div>
        <!--出票账户-->
        <div style="display: flex;margin: 10px 0">
            <div class="minTitle" style="width: 200px">
                <span class="red">*</span>
                <span >出票账户：</span>
            </div>
            <div>
                <radio-group  v-model="ticketUsername">
                    <!--<div>-->
                    <Radio :label="value" v-for="(ele,value,index) in ForticketUsername" :key="index">
                        <span>{{value}}</span>
                        <Select  size="small" style="width:120px" :id="value">
                            <Option v-for="(item,inde) in ele" :value="item" :key="inde">{{item}}</Option>
                        </Select>
                    </Radio>
                    <!--</div>-->
                </radio-group>
            </div>
        </div>
        <!--支付方式-->
        <div>
            <span class="red">*</span>
            <div>支付方式：</div>
            <radio-group  v-model="policyObj.pay_type">
                <Radio label=1>
                    <span>易宝支付</span>
                </Radio>
                <Radio label=2>
                    <span>票速通</span>
                </Radio>
                <Radio label=3>
                    <span>DZ预存款</span>
                </Radio>
            </radio-group>
        </div>
        <!--BSP出票规则-->
        <div>
            <div class="minTitle">
                <span class="red">*</span>
                <span>BSP出票规则：</span>
            </div>
            <radio-group v-model="policyObj.BSP_root">
                <Radio label=0>
                    <span>参照B2B出票政策</span>
                </Radio>
                <Radio label=1>
                    <span>直接出票，不参照B2B出票政策(仅支持相同票价出票)</span>
                </Radio>
                <Radio label=2>
                    <span>参照PAT：A最低价出票(注意：自动出票后返设置)</span>
                </Radio>
            </radio-group>
        </div>
        <!--B2B出票规则-->
        <div>
            <div class="minTitle">
                <span class="red">*</span>
                <span >B2B出票规则：</span>
            </div>
            <radio-group v-model="policyObj.B2B_root">
                <Radio label=0>
                    <span>不切换</span>
                </Radio>
                <Radio label=1>
                    <span>切换BSP</span>
                </Radio>
                <Radio label=2>
                    <span>切换BOP</span>
                </Radio>
                <Radio label=3>
                    <span>直接出票，不参照B2B出票政策(仅支持相同票价出票)</span>
                </Radio>
            </radio-group>
        </div>
        <!--适用对象-->
        <div >
            <div class="minTitle">
                <span class="red">*</span>
                <span>适用对象：</span>
            </div>
            <div class="plateCheckedDiv">
                <div class="plateChecked">
                    <input type="checkbox" id="plateAll" @click="plattformHandleCheckAll" ref="plateAll">
                    <span>全选</span>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="1" value=1 v-model="plattformCheckAll">
                    <label for="1">XSS</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="2" value=2 v-model="plattformCheckAll">
                    <label for="2">XSG</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="3" value=3 v-model="plattformCheckAll">
                    <label for="3">TTR</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="4" value="4" v-model="plattformCheckAll">
                    <label for="4">携程</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="5" value="5" v-model="plattformCheckAll">
                    <label for="5">携程团队</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="6" value="6" v-model="plattformCheckAll">
                    <label for="6">平安淘宝</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="7" value="7" v-model="plattformCheckAll">
                    <label for="7">向上淘宝</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="8" value="8" v-model="plattformCheckAll">
                    <label for="8">淘宝B平台</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="9" value="9" v-model="plattformCheckAll">
                    <label for="9">同程</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="10" value="10" v-model="plattformCheckAll">
                    <label for="10">美团</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="11" value="11" v-model="plattformCheckAll">
                    <label for="11">517</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="12" value="12" v-model="plattformCheckAll">
                    <label for="12">八千翼</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="13" value="13" v-model="plattformCheckAll">
                    <label for="13">pai</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="14" value="14" v-model="plattformCheckAll">
                    <label for="14">同程klf</label>
                </div>
                <div class="plateChecked">
                    <input type="checkbox" id="15" value="15" v-model="plattformCheckAll">
                    <label for="15">携程klf</label>
                </div>
            </div>
        </div>
        <!--票价范围设置-->
        <div>
            <span class="red">*</span>
            <span>票价范围设置：</span>
            <radio-group v-model="fare_root">
                <Radio label="2">
                    <span>适用全部</span>
                </Radio>
                <Radio label="1">
                    <span>大于</span>
                </Radio>
                <Radio label="0">
                    <span>小于</span>
                </Radio>
            </radio-group>
            <i-input style="width: 200px" v-model="fare_rootValue">
                <span slot="prepend">票价</span>
            </i-input>
            <span style="font-size: 12px;color: red">&nbsp;（当选择大于或小于时，票价栏必填）</span>
        </div>
        <!--适否换编码出票-->
        <div>
            <span class="red">*</span>
            <span>是否换编码出票：</span>
            <radio-group v-model="policyObj.is_new_pnr">
                <Radio label="0">
                    <span>是</span>
                </Radio>
                <Radio label="1">
                    <span>否</span>
                </Radio>
            </radio-group>
        </div>
        <!--需要授权的office号-->
        <div>
            <span>需要授权的office号：</span>
            <select  size="small" style="width:100px" v-model="policyObj.office">
                <option v-for="item in cityList" :value="item.value" :key="item.value">{{ item.label }}</option>
            </select>
        </div>
        <!--备注-->
        <div style="width: 50%">
            <i-input type="textarea" v-model="policyObj.ticket_remarks" :rows="4" size="small" placeholder="Enter something..." />
        </div>
        <div style="display: flex;flex-direction: row-reverse">
            <button class="butt"  @click="dealPolicyClose">返回</button>
            <button class="butt"  @click="dealPolicySure">确定</button>
        </div>
    </div>
</template>
<!--批量修改弹窗-->
<template id="lotSizeChange">
    <div id="lotSizeChangeWindow">
        <header class="dealHeader">
            <div>批量修改</div>
            <i-button  size="small" shape="circle" style="position: absolute;right: 5px;top: 3px;font-weight: bold;" @click="closeLotSizeFun">X</i-button>
        </header>
        <!--起飞日期-->
        <div>
            <span>起飞日期：</span>
            <date-picker type="daterange"  format="yyyy-MM-dd" @on-change="timeFly" v-model="fly_date" split-panels placeholder="Select date" placement="bottom-end" placeholder="Select date" style="width: 200px"></date-picker>
        </div>
        <!--出票日期-->
        <div>
            <span>出票日期：</span>
            <date-picker type="daterange" @on-change="timeTicket" v-model="ticket_date" split-panels placeholder="Select date" placement="bottom-end" placeholder="Select date" style="width: 200px"></date-picker>
        </div>
        <!--最大亏损-->
        <div>
            <label style="margin-right: 20px"><input type="radio" value="loss"  v-model="loss"  ><span>最大亏损</span></label>
            <label style="margin-right: 20px"><input type="radio" value="rebate" v-model="loss"  ><span>最大亏损返点</span></label>
            <i-input style="width: 200px" v-model.trim="lossInputValue">
                <span slot="prepend">最大亏损(+/-)</span>
            </i-input>

        </div>
        <div style="display: flex;flex-direction: row-reverse">
            <button class="butt"  @click="closeLotSizeFun">返回</button>
            <button class="butt"  @click="sureLotSizeFun">确定</button>
        </div>
    </div>
</template>

<!--<script type="text/javascript" src="../vue/vuex.js"></script>-->
<!--<script type="text/javascript" src="../resource/iview-2.0/dist/iview.js"></script>-->
<script type="text/javascript" src="../resource/iview-2.0/dist/iview.min.js"></script>
<script type="text/javascript" src="../vue/vuex.js"></script>
<script type="text/javascript" src="../vue/axios.min.js"></script>
<script type="text/javascript" src="../vue/vue-router.js"></script>
<!--<script src="//unpkg.com/iview/dist/iview.min.js"></script>-->
<script type="text/javascript">
    Vue.config.devtools = true;
    Vue.config.debug = true;
    //政策主体table
    Vue.component('policy',{
        template:'#table-div-dom',
        data(){
            return{
                //政策主体数据
                tableObj:null,
                num:1,
                //nnum用来保存num之前的页数
                nnum:undefined,
                pages:undefined,
                findObj:null,
            }
        },
        methods:{
            //初始化数据请求函数
            tableData(page,findObj=null){
                if(findObj){
                    this.findObj = findObj;
                }
                axios({
                    url:'../bingo/automatic.php?action=all_policy',
                    method:'post',
                    data:{
                        findObj,
                        page,
                    }
                }).then(res=>{
                    this.tableObj = res.data.list;
                    this.pages = res.data.pages;
                }).catch(err=>{
                    console.log(err)
                })
            },
            //全选input按钮
            allInput(){
                if(!this.tableObj){
                    return
                }
                if(event.target.checked){
                    this.$store.state.idList = [];
                    for(let a=0,leng = this.tableObj.length;a<leng;a++){
                        this.$refs.inputDom[a].checked = true;
                        this.$store.state.idList.push(this.tableObj[a].id);
                    }
                }else{
                    for(let a=0,leng = this.tableObj.length;a<leng;a++){
                        this.$refs.inputDom[a].checked = false;
                        this.$store.state.idList=[];
                    }
                }
            },
            //禁用按钮
            disable(idd){
                this.$store.state.idList.push(idd);
                let id = this.$store.state.idList;
                axios({
                    url:'../bingo/automatic.php?action=disable',
                    method:'post',
                    data:id
                }).then(res=>{
                    if(res.data=='success'){
                        window.location.reload(true)
                    }
                }).catch(err=>{
                    console.log(err)
                })
            },
            //启用按钮
            enable(data){
                this.$store.state.idList.push(data);
                let id = this.$store.state.idList;
                axios({
                    url:'../bingo/automatic.php?action=enable',
                    method:'post',
                    data:id
                }).then(res=>{
                    if(res.data=='success'){
                        window.location.reload(true)
                    }
                }).catch(err=>{
                    console.log(err)
                })
            },
            //input选择单个政策
            addId(id){
                let allDom = document.getElementById('inputAllDom');
                if(event.target.checked){
                    this.$store.state.idList.push(id);
                    if(this.$store.state.idList.length == this.tableObj.length){
                        allDom.checked = true;
                    }
                }else{
                    this.$store.state.idList.forEach((value,index)=>{
                        if(value==id){
                            this.$store.state.idList.splice(index,1);
                        }
                    })
                    allDom.checked = false;
                }
            },
            //无效，有效，全选三个单选的按钮函数
            ThreeRadioFun(data){
                if(data=='ok'){
                    this.effectiveFun()
                }else if(data=='no'){
                    this.invalid()
                }else{
                    axios({
                        url:'../bingo/automatic.php?action=all_policy',
                        method:'post',
                        data:{
                            page:1
                        }
                    }).then(res=>{
                        this.tableObj = res.data.list;
                    }).catch(err=>{
                        console.log(err)
                    })
                }
            },
            //无效按钮r
            invalid(){
                axios({
                    url:'../bingo/automatic.php?action=invalid',
                    method:'post',
                    data:{
                        page:0
                    }
                }).then(res=>{
                    this.tableObj = res.data.list;
                }).catch(err=>{
                    console.log(err)
                })
            },
            //有效按钮
            effectiveFun(){
                axios({
                    url:'../bingo/automatic.php?action=effective',
                    method:'post',
                    data:{
                        page:0
                    }
                }).then(res=>{
                    this.tableObj = res.data.list;
                    console.log(res.data)
                }).catch(err=>{
                    console.log(err)
                })
            },
            //全选按钮就是created函数中的请求
            //是否显示查询框
            findshow(){
                this.$store.state.findFlag = ! this.$store.state.findFlag
            },
            //新增按钮
            newAdd(){
                //开启关闭处理政策弹窗
                this.$store.state.dealPolicy = ! this.$store.state.dealPolicy;
                //告诉弹窗当前触发的是新增按钮
                this.$store.state.policyFunctionFlag = true;

            },
            //修改按钮
            changePolicy(id){
                //告诉弹窗当前触发的是修改按钮
                // let leng = this.$store.state.idList.length;
                // if(leng==1){
                this.$store.state.policyFunctionFlag = false;
                this.$store.state.dealPolicy = ! this.$store.state.dealPolicy;
                this.$store.state.ordId = id;
                // }else{
                //     alert('修改功能只支持单个订单修改，请勿多选')
                // }
            },
            //复制按钮
            copyFun(){
                axios({
                    url:'../bingo/automatic.php?action=copy',
                    method:'post',
                    data:{
                        id:this.$store.state.idList
                    }
                }).then(res=>{
                    this.tableObj = res.data.list;
                }).catch(err=>{
                    console.log(err)
                })
            },
            //批量修改
            lotChange(){
                //批量修改弹窗开关，在store中触发
                this.$store.commit('lotSizeFlagChangeFun')
            },
            //批量删除
            logDelet(){
                axios({
                    url:'../bingo/automatic.php?action=delete',
                    method:'post',
                    data:{
                        id:this.$store.state.idList
                    }
                }).then(res=>{
                    this.tableObj = res.data.list;
                    console.log(res.data)
                }).catch(err=>{
                    console.log(err)
                })
            },
            //分页函数
            //保存num
            saveNum(data){
                this.nnum = data;
            },
            //向后转页面 —
            uppage:function(){
                if(this.num>1){
                    this.num -= 1;
                }else if(this.num<1){
                    alert('没有该用页码')
                }else{
                    return
                };
                this.axfun(this.num);
            },
            //向前转页面 +
            downpage:function(){
                this.num = Number(this.num); //之前的显示数字其本质为字符串导致无法数字计算
                if(this.num<this.pages){
                    this.num = this.num + 1;
                }else{
                    return
                };
                this.axfun(this.num)
            },
            //直接去某页面
            gotopage:function () {
                let val = this.num;
                if(val > this.pages||val<1){
                    this.num = this.nnum;
                    alert('没有该页码');
                }else if(val==this.pages){
                    //输入框当前页等于总页数的时候，是没必要做跳转的
                    return
                }else{
                    this.num = Math.round(this.num);
                    this.num = val;
                    this.axfun(this.num)
                }
            },
            //直接去首页
            firstpage:function () {
                if(this.num == 1){
                    return
                }else{
                    this.num = 1;
                    this.axfun(this.num)
                }
            },
            //直接去末尾页
            lastpage:function () {
                if(this.num == this.pages){return}else {
                    this.num = this.pages;
                    this.axfun(this.num);
                }
            },
            //跳转后把页面值传入，用来获取要跳转页面的数据，此函数为上面所有跳转函数的通用操作
            axfun:function(page){
                this.tableData(page,this.findObj)
            },
        },
        filters:{
            platform(data){
                // data = data*1
                data = data.split(';');
                data.splice(0,1);
                data.splice(data.length-1,1)
                let s = '';
                for(let a=0;a<data.length;a++){
                    s += replacePlateFun(data[a]) + ';'
                }
                function replacePlateFun(str){
                    str = str*1
                    switch(str){
                        case 1:
                            return "XSS";
                        case 2:
                            return "XSG";
                        case 3:
                            return "TTR";
                        case 4:
                            return "携程";
                        case 5:
                            return "携程团队";
                        case 6:
                            return "平安淘宝";
                        case 7:
                            return "向上淘宝";
                        case 8:
                            return "淘宝B平台";
                        case 9:
                            return "同程";
                        case 10:
                            return "美团";
                        case 11:
                            return "517";
                        case 12:
                            return "八千翼";
                        case 13:
                            return "pai";
                        default:
                            return '未知平台'
                    }
                }



                // a = a.replace('1', "XSS");
                // a = a.replace('2', "XSG");
                // a = a.replace('3', "TTR");
                // a = a.replace('4', "携程");
                // a = a.replace('5', "携程团队");
                // a = a.replace('6', "平安淘宝");
                // a = a.replace('7', "向上淘宝");
                // a = a.replace('8', "淘宝B平台");
                // a = a.replace('9', "同程");
                // a = a.replace('10', "美团");
                // a = a.replace('11', "517");
                // a = a.replace('12', "八千翼");
                // a = a.replace('13', "pai");
                // a = a.replace('0', "全部");
                return s
            },
            tickType(data){
                if(data){
                    let data01 = data.split('-');
                    return data01[0];
                }
            },
            tickAccount(data){
                if(data){
                    let data01 = data.split('-');
                    return data01[1];
                }
            },
            // positionfun(data){
            //     //原始数据会传0，1,这样的前缀值，然而展示页面暂时不需要前缀。
            //     // let data01 = data.split(/([0-9]-)/);
            //     return data
            // },
            is_effectiveFun(data){
                if(data){
                    switch (data) {
                        case '1':return '生效';
                        case '0':return '禁用';
                        case '2':return '过期';
                    }
                }
            },
            fare_rootFilter(data){
                if(data){
                    let data00 = data.split(/-/);
                    if(data00[0]!='2'){
                        switch (data00[0]) {
                            case '0':return "小于"+data00[1];
                            case '1':return "大于"+data00[1];
                        }
                    }else{
                        return "适用全部"
                    }
                }
            }
        },
        created(){
            this.tableData(1)
        }
    });
    //搜索框
    Vue.component('findWindow',{
        template:'#findWindow',
        data(){
            return{
                //政策编码
                policyCode:null,
                //乘客类型
                passenger_type:null,
                //航司
                airline:null,
                //出发城市
                dpt_city:null,
                //到达城市
                arr_city:null,
                //出票方式
                pay_type: [
                    {
                        value: 1,
                        label: '易宝'
                    },
                    {
                        value: 2,
                        label: '票速通'
                    },
                    {
                        value: 3,
                        label: 'DZ预存款'
                    },
                ],
                //出票方式选择值
                picketMethods:null,
                //适用对象,for循环使用数组
                plattform:[
                    {value:0, label:'适用全部'},
                    {value:1, label:'XSS'},
                    {value:2, label:'XSG'},
                    {value:3, label:'TTR'},
                    {value:4, label:'携程'},
                    {value:5, label:'携程团队'},
                    {value:6, label:'平安淘宝'},
                    {value:7, label:'向上淘宝'},
                    {value:8, label:'淘宝B平台'},
                    {value:9, label:'同程'},
                    {value:10, label:'美团'},
                    {value:11, label:517},
                ],
                //适用对象的选择值
                suitableObj:null,
                //航班日期
                dateValue:null
            }
        },
        computed:{
            findFlag(){
                return this.$store.state.findFlag;
            }
        },
        methods:{
            handleChange(data){
                this.dateValue = data
            },
            //查找方法
            findFun(){
                //实际调用的是table的请求数据的方法。
                let findObj = {
                    //乘客类型
                    passenger_type:this.passenger_type,
                    //航司
                    airline:this.airline,
                    //出发城市
                    dpt_city:this.dpt_city,
                    //到达城市
                    arr_city:this.arr_city,
                    //出票方式选择值
                    picketMethods:this.picketMethods,
                    ///适用对象
                    suitableObj:this.suitableObj,

                    //政策编码
                    policyCode:this.policyCode,
                };
                //航班日期
                if(this.dateValue){
                    findObj.fly_date_max = this.dateValue[0];
                    findObj.fly_date_min = this.dateValue[1];
                }else{
                    findObj.fly_date_max = null;
                    findObj.fly_date_min = null;
                }
                return this.$parent.$refs.policyTable.tableData(1,findObj)
            }
        }
    });
    //翻页
    Vue.component('changepage',{
        template:'changepage'
    });
    //处理页面
    Vue.component('dealPolicy',{
        template:'#dealPolicy',
        data(){
            return{
                //是否显示处理窗口
                policyObj:{
                    //行程类别
                    stroke_type:"0",
                    //乘客类型
                    passenger_type:'0',
                    //适应乘客人数小值
                    passenger_num_min:1,
                    //适应乘客人数大值
                    passenger_num_max:9,
                    //航司
                    airline:null,
                    //出发城市
                    dpt_city:null,
                    //到达城市
                    arr_city:null,
                    //适用航班
                    flight:'2',
                    //仓位全选按钮值
                    position:undefined,
                    //起飞日期始
                    fly_date_min:null,
                    //起飞日期止
                    fly_date_max:null,
                    //    出票日始
                    ticket_date_min:null,
                    //出票日止
                    ticket_date_max:null,
                    //    最大亏损
                    loss:true,
                    rebate:false,
                    //进单编码
                    code:'CSX107',
                    //    出票账户、
                    ticket_username:null,
                    //支付方式
                    pay_type:'',
                    // //大客户号
                    //     big_customer:null,
                    //BSP 出票规则
                    BSP_root:'0',
                    //    B2B出票规则
                    B2B_root:'0',
                    //    平台
                    plattform:'0',
                    //    票价范围规则
                    fare_root:undefined,
                    //    是否换编码出票
                    is_new_pnr:'1',
                    //    需要授权的office号
                    office:null,
                    //    备注
                    ticket_remarks:null,

                },
                //航司 ajax后获取的数据
                airline:null,
                //舱位没有全选时候的样式
                indeterminate:false,
                //选择舱位是否全选的样式按钮
                checkAll: false,
                //舱位选择后的被勾选的数据
                position:null,
                //适用航班的radio和input
                flight:undefined,
                flightText:undefined,
                //票价范围radio和input值
                fare_root:undefined,
                fare_rootValue:undefined,
                //给后台的policyObj中的账号相关数据都不会用到下面两个数据，
                //出票账户被勾选的账号。
                ticketUsername:null,
                //用与for循环的出票select载体
                ForticketUsername:null,
                //因为数据要经过一定的格式化后给后台。下面才是要给后台的数据，但是因为是用了select的触发函数，
                //所以如果没有触发，那就只能用默认值，所以有个默认值也是传后台的。
                //要发给后台的ajax的平台和账号，格式已经调好，可直接使用,
                ticket_username:null,
                cityList:null,
                model1: '',
                //    最大亏损的input值
                loss:'loss',
                lossInputValue:-15,
                //    平台多选功能
                plattformIndeterminate:false,
                plattformCheckAll:[],
            }
        },
        computed:{
            dealPolicy(){
                return this.$store.state.dealPolicy
            },
            fly_date(){
                const t1 = this.policyObj.fly_date_min;
                const t2 = this.policyObj.fly_date_max;
                return [t1,t2]
            },
            ticket_date(){
                const t1 = this.policyObj.ticket_date_min;
                const t2 = this.policyObj.ticket_date_max;
                return [t1,t2]
            }
        },
        watch:{
            //平台多选操作
            plattformCheckAll(){
                if(this.plattformCheckAll.length === 13){
                    this.$refs.plateAll.checked = true
                }else{
                    this.$refs.plateAll.checked = false
                }
            }
        },
        methods:{
            //处理政策页面的关闭按钮
            dealPolicyClose(){
                this.$store.state.dealPolicy = ! this.$store.state.dealPolicy;
            },
            //舱位全选按钮的function
            handleCheckAll(){
                if (this.indeterminate) {
                    this.checkAll = false;
                } else {
                    this.checkAll = !this.checkAll;
                }
                //该按钮一旦按下，部分选中的样式恒为false
                this.indeterminate = false;
                if (this.checkAll) {
                    this.policyObj.position = this.position;
                } else {
                    this.policyObj.position = [];
                }
            },
            //舱位多选按钮单个按钮触发的样式改变，与数据逻辑没有关系，只关乎样式
            //舱位多选与全选引用的是iview的逻辑，所以它本身内部封装了逻辑，使用的话直接配好数据即可
            checkAllGroupChange(data){
                if(data.length === this.position.length){
                    this.checkAll = true;
                    this.indeterminate = false;
                }else if(data.length>0){
                    this.checkAll = false;
                    this.indeterminate = true;
                }else{
                    this.checkAll = false;
                    this.indeterminate = false;
                }
            },
            ceshi(){
                let data = this.policyObj.airline;
                if(data){
                    axios({
                        url:'../bingo/automatic.php?action=obtain_position',
                        method:'post',
                        data:{
                            airline:data
                        }
                    }).then(res=>{
                        let arrPosition = res.data.position.split(/;{1,}/);
                        this.position = arrPosition;
                    }).catch(err=>{
                        console.log(err)
                    })
                }
            },
            //平台多选
            plattformHandleCheckAll () {
                if(event.target.checked){
                    this.plattformCheckAll = ["1", "2", "3", "4","5","6", "7", "8", "9", "10", "11", "12", "13"]
                }else{
                    this.plattformCheckAll = [];
                }
            },
            //起飞时间出发函数
            timeFly(data){
                this.policyObj.fly_date_min = data[0];
                this.policyObj.fly_date_max = data[1];
            },
            //持票时间出发函数
            timeTicket(data){
                this.policyObj.ticket_date_min = data[0];
                this.policyObj.ticket_date_max = data[1];
            },
            //政策页面确定按钮
            dealPolicySure(){
                //最大亏损是否纯数字判断
                let a = (this.lossInputValue)*1;
                //有无非数字 有 进入判断
                if(!a){
                    //非数字是否是符号 . 是则进入判断
                    alert('最大亏损只能输入正确格式的金额');
                    return
                }
                //确定按钮的新增函数
                let policyObj = JSON.parse(JSON.stringify(this.policyObj));
                //修改仓位的数据格式
                var strPosition = '';
                //不一定每个航司都有舱位
                if(policyObj.position){
                    for(let a = 0,leng = policyObj.position.length;a<leng;a++){
                        if(a==leng-1){
                            strPosition += policyObj.position[a]
                        }else{
                            strPosition += policyObj.position[a]+';';
                        }
                    };
                }else{
                    policyObj.position = true;
                }
                policyObj.position = strPosition;
                //出票账户数据，并调好格式
                if(!this.ticketUsername){
                    alert('出票账户没有勾选')
                    return
                }
                let valu = document.getElementById(this.ticketUsername).value;
                this.ticket_username = this.ticketUsername+'-'+valu;
                policyObj.ticket_username = this.ticket_username;
                //票价范围设置格式调整
                if(this.fare_root=='2'){
                    policyObj.fare_root = this.fare_root
                }else{
                    //判断票价范围，当选择大于或小于的时候，票价必填
                    if(!((this.fare_rootValue.trim())*1)){return alert('票价必填且为数字')}
                    policyObj.fare_root = this.fare_root +'-'+this.fare_rootValue.trim();
                }
                //适用航班格式调整
                if(this.flight=='2'){
                    policyObj.flight = this.flight;
                }else{
                    policyObj.flight = this.flight +'-'+ this.flightText;
                }
                //最大亏损格式调整
                if(this.loss == 'loss'){
                    policyObj.loss = this.lossInputValue;
                    policyObj.rebate = null;
                }else if(this.loss == 'rebate'){
                    policyObj.rebate = this.lossInputValue;;
                    policyObj.loss = null
                }

                //适用平台格式调整
                let plateCheck = '';
                let plateChecklength = this.plattformCheckAll.length;
                if(plateChecklength === 1){
                    plateCheck = this.plattformCheckAll[0]+';';
                }else{
                    plateCheck = this.plattformCheckAll[0]+';'
                    for(let i=1;i<plateChecklength;i++){
                        plateCheck += this.plattformCheckAll[i]+';'
                    }

                }
                plateCheck = ';'+plateCheck
                policyObj.plattform = plateCheck;

                //确认必选项是否都已填上
                if(!(policyObj.B2B_root&&policyObj.BSP_root&&policyObj.fare_root&&policyObj.flight)){
                    switch(false){
                        case !!policyObj.B2B_root:alert('B2B出票规则 没有填写');return;
                        case !!policyObj.BSP_root:alert('BSP出票规则 没有填写');return;
                        case !!policyObj.fare_root:alert('票价范围规则 没有填写');return;
                        case !!policyObj.flight:alert('适用航班 没有填写');return;
                            break
                    }
                    return
                }else if(!(policyObj.is_new_pnr&&policyObj.passenger_num_max&&policyObj.passenger_num_min)){
                    switch(false){
                        case !!policyObj.is_new_pnr:alert('是否换编码出票 没有填写');return;
                        case !!policyObj.passenger_num_max:alert('适应乘客人数大值 没有填写');return;
                        case !!policyObj.passenger_num_min:alert('适应乘客人数小值 没有填写');return;
                        case !!policyObj.pay_type:alert('支付方式 没有填写');return;
                            break
                    }
                }else if(!(policyObj.plattform&&policyObj.position&&policyObj.stroke_type&&policyObj.passenger_type)){
                    switch(false){
                        case !!policyObj.plattform:alert('适用对象(平台) 没有填写');return;
                        case !!policyObj.position:alert('仓位 没有填写');return;
                        case !!policyObj.passenger_type:alert('乘客类型 没有填写');return;
                            break
                    }
                }
                if(this.$store.state.policyFunctionFlag){
                    axios({
                        url:'../bingo/automatic.php?action=confirm',
                        method:'post',
                        data:policyObj
                    }).then(res=>{
                        this.$store.state.dealPolicy = false;
                        // window.location.reload(true);
                    }).catch(err=>{
                        console.log(err)
                    })
                }else{
                    //确定按钮的修改函数
                    axios({
                        url:'../bingo/automatic.php?action=check_update',
                        method:'post',
                        data:policyObj
                    }).then(res=>{
                        this.$store.state.dealPolicy = false;
                        // this.tableObj = res.data.list;
                        console.log(res.data)
                    }).catch(err=>{
                        console.log(err)
                    })
                }
            },
        },
        mounted(){

        },
        created(){
            //this.$store.state.policyFunctionFlag用来判断当前是用的新增函数修改按钮
            //新增按钮函数
            if(this.$store.state.policyFunctionFlag){
                axios({
                    url:'../bingo/automatic.php?action=add_new',
                    method:'get',
                }).then(res=>{
                    this.airline = res.data.airline;
                    this.position = res.data.position;
                    this.ForticketUsername = res.data.ticket_username;
                }).catch(err=>{
                    console.log(err)
                })
            }else{
                if(this.$store.state.ordId){
                    var id = [];
                    id.push(this.$store.state.ordId);
                }else{
                    var id = this.$store.state.idList;
                }
                //修改按钮函数
                axios({
                    url:'../bingo/automatic.php?action=modify',
                    method:'post',
                    data:{
                        id
                    }
                }).then(res=>{
                    //所有出票账户，用与for循环
                    this.ForticketUsername = res.data.ticket_username;
                    //出票账户默认选中值
                    let a03 = res.data.list[0].ticket_username.split(/-/);
                    this.ticketUsername = a03[0];
                    setTimeout(()=>{
                        let seleId = document.getElementById(a03[0]);
                        seleId.value = a03[1]
                    },0)
                    //主体数据，包括航司中被选中的航司，仓位中被选中的仓位
                    this.policyObj = res.data.list[0];
                    //最大亏损调整渲染值，此出不直接只用最大亏损作为radio是否选择
                    //参数原因在于，当值为0时，会导致radio不可选
                    if(this.policyObj.loss||this.policyObj.loss == 0){
                        this.loss = 'loss';
                        this.lossInputValue = this.policyObj.loss
                    }else if(this.policyObj.rebate||this.policyObj.rebate == 0){
                        this.loss = 'rebate';
                        this.lossInputValue = this.policyObj.rebate
                    }
                    //所有航司，用与for循环
                    this.airline = res.data.airline;
                    //所有仓位，用与for循环,字符串做数组
                    if(res.data.position){
                        let arrPosition = res.data.position.split(/;{1,}/);
                        this.position = arrPosition;
                    }
                    //ticket_username会在修改框确定按钮函数中用来传给后台；此时是拿最初的默认值，应该可以废除了；
                    // this.ticket_username = res.data.list[0].ticket_username;
                    //仓位格式排列
                    let arr01 = res.data.list[0].position.split(/;{1,}/);
                    this.policyObj.position = arr01;
                    // policyObj.position
                    //航班radio选项和input选项
                    let a01 = res.data.list[0].flight.split(/-/);
                    this.flight = a01[0];
                    this.flightText = a01[1];
                    a01 = null;
                    //票价范围设置
                    let a02 = res.data.list[0].fare_root.split(/-/);
                    this.fare_root = a02[0];
                    this.fare_rootValue = a02[1];
                    //起飞日期格式调整
                    this.policyObj.fly_date =[res.data.list[0].fly_date_min, res.data.list[0].fly_date_max];
                    //出票日期格式调整
                    this.policyObj.ticket_date = [res.data.list[0].ticket_date_min,res.data.list[0].ticket_date_max]
                    //平台格式调整
                    let platt = res.data.list[0].plattform;
                    platt = platt.split(';');
                    platt.splice(0,1);
                    platt.splice(platt.length-1,1)
                    console.log(platt)
                    this.plattformCheckAll = platt;
                    //重置vuex里面的id为空
                    this.$store.state.ordId = undefined;
                }).catch(err=>{
                    console.log(err)
                })
            }
        }
    });
    //批量修改弹窗
    Vue.component('lotSizeChange',{
        template:'#lotSizeChange',
        data(){
            return{
                fly_date:undefined,
                ticket_date:undefined,
                loss:"loss",
                lossInputValue:15,
                policyObj:{},
            }
        },
        computed:{},
        methods:{
            closeLotSizeFun(){
                //批量修改弹窗开关，在store中触发
                this.$store.commit('lotSizeFlagChangeFun');
            },
            //起飞时间出发函数
            timeFly(data){
                this.policyObj.fly_date_min = data[0];
                this.policyObj.fly_date_max = data[1];
            },
            //持票时间出发函数
            timeTicket(data){
                this.policyObj.ticket_date_min = data[0];
                this.policyObj.ticket_date_max = data[1];
            },
            //    提交批量修改数据
            sureLotSizeFun(){
                //最大亏损格式调整
                if(this.loss == 'loss'){
                    this.policyObj.rebate = null;
                }else if(this.loss == 'rebate'){
                    this.policyObj.loss = null;
                }
                this.policyObj[this.loss] = this.lossInputValue;
                this.policyObj.idList = this.$store.state.idList;
                console.log(this.$store.state.idList);
                console.log(this.policyObj);
                // axios().then().catch()
            },
        }
    })
    const store = new Vuex.Store({
        state:{
            //查找传开关
            findFlag:false,
            //处理 操作政策弹窗的开关，
            dealPolicy:false,
            //开启操作政策弹窗后调用不同函数体的开关，新增和修改都是开启弹窗，但是两种调用的函数不同
            //初始值为true,表总是新增
            policyFunctionFlag:true,
            //政策弹窗的数据载体
            dealPolicyObj:null,
            //    保存已经勾选的序号
            idList:[],
            //当单个政策需要修改的时候，用来传给后台的id
            ordId:undefined,
            //    批量修改开关
            lotSizeFlag:false,
        },
        mutations:{
            //批量修改弹窗开关
            lotSizeFlagChangeFun(state){
                state.lotSizeFlag = !state.lotSizeFlag;
            }
        }
    });
    let a = new Vue({
        el:'#VuePolicy',
        store,
        data:{

        },
        computed:{
            findFlag(){
                return this.$store.state.findFlag;
            },
            dealPolicy(){
                return this.$store.state.dealPolicy;
            },
            lotSizeFlag(){
                return this.$store.state.lotSizeFlag;
            }
        },

    })
</script>
</body>
</html>