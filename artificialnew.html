<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>人工出票处理</title>
    <script src="../vue/vue.js"></script>
    <link rel="stylesheet" href="../resource/iview-2.0/dist/styles/iview.css">
    <link rel="stylesheet" href="../resource/css/tableCustom.css" >
    <style>
        /*----搜索框的诸多样式集合----*/
        /*开启搜索框的dom*/
        .searchDom{
            /*margin-top: 50px;*/
            position: absolute;
            margin-left: 10px;
            margin-top: -5px;
            background-image:url('../images/font/search04.png');
            width: 32px;
            height: 32px;
            background-size: 80%;
            background-repeat: no-repeat;
            display: inline-block;
            cursor:pointer;
        }
        .platformOrderDom{
            position: absolute;
            margin-left: 175px;
            top: -10px;
            margin-bottom: 5px;
            /*display: inline-block;*/
        }
        /*搜索框内部模块*/
        #choose{
            margin: 5px 5px;
            width: 1200px;
        }
        .chooseOne{
            /*width: 100%;*/
            display: flex;
            flex-wrap: wrap;
            align-items: center;

            /*flex-grow: ;*/
        }
        .chooseOne>div{
            margin: 0 10px 0 10px;
        }
        .chooseTwo{
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            /*flex-grow: ;*/
        }
        .chooseChild{
            width: 250px;
            margin: 10px;
        }
        .chooseChildA{
            width: 100px;
        }
        .chooseInput{
            width: 250px;
        }
        /*----table样式集合----*/
        /*table下字体，图标样式*/
        /*用与航班信息字体标红*/
        div[data-red='red']>div{
            color: red;
        }
        /*用于时长标红*/
        div[data-redTime='red']{
            background-color: red;
        }
        /*余位字体标红*/
        div[data-cursite='1']{
            color: red;
            font-weight: bold;
        }
        /*未锁单页面红叉样式*/
        .cha{
            position: relative;
            top: 20px;
            left: 1%;
            width: 15px;
            height: 15px;
            background-image: url('../images/font/cha03.png');
            background-size: 100% 100%;
            background-repeat: no-repeat;
        }
        /*复制按钮的样式*/
        .fuzhi{
            display: inline-block;
            cursor: pointer;
            background-image: url("../images/font/fuzhi3.png");
            background-repeat: no-repeat;
            background-size: 100% 100%;
            width: 15px;
            height: 15px;
            margin-top: -5px;
        }
        .fuzhi:active{
            border: 1px black solid;
        }
        .fuzhiDom{
            position: absolute;
            left: -300px;
        }
        .fuzhiId{
            background-color: red;
        }
        /*table内部日志，游客模式按钮样式*/
        .curspointertwo:hover{
            box-shadow: 1px 1px 2px 1px gray;
            cursor:pointer;
        }
        /*table主体样式*/
        table{
            width: 100%;
        }
        .ariticialTalbe{
            border: 1px silver solid;
        }
        /*给头加border*/
        .headBorder>th{
            border: 1px #E7E7E7 solid;
        }
        /*给tr加border*/
        .ariticialTalbeChild>tr>td{
            border: 1px #E7E7E7 solid;
        }
        /*航班信息的样式*/
        .td_message{
            display: flex;
            /*width: 120px;*/
            margin: 0 auto;
            justify-content: space-around;
            flex-wrap: wrap;
            width: 130px;
        }
        .td_message>div{
            margin-left: 2px;
        }
        /*比价的样式*/
        .td_price>div{
            /*float: left;*/
            /*margin-left: 8px;*/
            display: flex;
            justify-content: center;
            margin-top: 2px;
        }
        .td_price>div>div{
            margin-left: 4px;
        }
        /*重付 重订的按钮的两种样式*/
        .buttOne{
            margin: -2px 0 1px 0;
        }
        .buttTwo{
            margin: 6px 0 1px 0;
        }
        .buttTwo:hover{
            background-color: #ABA3E0;

        }
        /*个人锁单按钮*/
        .aloneClock{
            position: absolute;
            margin-left: 112px;
            margin-top: -20px;
            width: auto;
            /*height: 32px;*/
        }
        /*确认筛选与条件筛选按钮的样式*/
        .buttThree{
            margin: 0 3px;
            border: 1px solid #C3C3D6;
            background-color: white;
            padding: 4px;
            cursor: pointer;
            border-radius: 4px;
        }
        .buttThree:hover{
            background-color: #ABA3E0;
        }
        .buttThree:active{
            background-color: skyblue;
        }
        /*表格中td作为点击button的样式*/
        .tdButton{
            cursor: pointer;
        }
        .tdButton:hover{
            color: deepskyblue;
        }
        /*搜索中iview的input边框改深色*/
        .ivu-input-group-prepend{
            border-color: silver;
        }
        .ivu-input{
            /*border-color: black;*/
        }
        .ivu-input-default{
            border-color: silver;
        }
        /*条件筛选样式*/
        /*条件筛选主体样式*/
        .conditionsFlag{
            position: fixed;
            width: 460px;
            height: auto;
            background-color: white;
            z-index: 10;
            box-shadow: 0 0 10px 0;
            top: 43%;
            left: 49%;
            transform: translate(-50%,-50%);
        }
        .conditionsFlag>*{
            padding: 7px;
            margin-top: 5px;
            padding-bottom: 10px;
            border-bottom: 1px solid silver;
        }
        /*条件筛选头部样式*/
        .titleHead{
            height: 70px;
            /*background-color: red;*/
            border-bottom: 1px solid silver;
        }
        .headPicture{
            width: 20%;
            height: 70%;
            margin-left: 45%;
            background-image: url("../images/font/computed01.png");
            background-size: 40%;
            background-repeat: no-repeat;

        }
        /*自动出票中查找样式*/
        /*自动出票中主体样式*/
        .ticketingChoose{
            display: flex;
        }
        /*.ticketingChoose>div{*/
            /*!*margin-top: 3px;*!*/
            /*margin-bottom: 5px;*/
        /*}*/
        .ticketingChooseTwo>div{
            margin-bottom: 5px;
        }
        .search{
            /*display: inline-block;*/
            /*position: relative;*/
            /*left: -30%;*/
            /*width: ;*/
            /*height: 20px;*/
            background-image: url('../images/font/ticketingSearch.png');
            background-repeat: no-repeat;
            background-size: 18px 18px;
            cursor:pointer;
        }
        .selectDom{
            padding: 5px;
            border-color: silver;
            border-radius:3px;
        }
        /*拆分按钮*/
        .splitButt{
            display: flex;
            flex-direction: row-reverse;
        }
        /*日志主体样式*/
        /*日志*/
        .log{
            width: 650px;
            height: 450px;
            box-shadow: 0 0 10px 0;
            position: fixed;
            top: 100px;
            left: 30%;
            background-color: white;
            z-index: 1;
        }
        .log>header>.headPicture{
            width: 50px;
            height: 50px;
            background-image: url('../images/font/log03.png');
            background-size: 100%;
            background-repeat:no-repeat;

        }
        .closeButt{
            width: 25px;
            height: 25px;
            background-image: url('../images/font/close02.png');
            background-size: 100%;
            background-repeat:no-repeat;
            margin: -3px -3px 0px 0px;
            cursor:pointer;
        }
        /*split拆分样式*/
        .splitWindow{
            position: fixed;
            top:50%;
            left: 50%;
            width: 600px;
            max-height:550px;
            overflow-x: hidden;
            box-shadow:0px 0px 10px 1px;
            background-color: white;
            z-index: 2;
            transform: translate(-50%, -50%);
        }
        .splitOneWindow{
            display: flex;
            justify-content: space-around;
        }
        .splitWindow header{
            height: 50px;
            border-bottom: 1px silver solid;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        .headertitle{
            margin-bottom: -20px;
        }
        .closesplit{
            position: absolute;
            top: 1px;
            right: 1px;
            cursor:pointer
        }
        .icon_split{
            position: absolute;
            top: 1px;
            width: 20px;
            height: 20px;
            background-image:url('../images/font/split.png');
            background-repeat:no-repeat;
            background-size:100% 100%;
        }
        .close_splitIcon{
            position: absolute;
            right: 0px;
            top: 0px;
        }
        .splitDeal{
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: right;
        }
        .splitDeal>*{
            margin-left: 5px;
        }
        .splitDeal>input{
            border: none;
            background-color: #1C84C6;

        }
        /*j标红*/
        .red{
            color: red;
        }
        /*动画*/
        .searchAnimation-enter-active, .searchAnimation-leave-active{
            transition: opacity .5s;
        }
        .searchAnimation-enter, .searchAnimation-leave-to{
            /*transform: translateY(-150px);*/
            opacity: 0;
            /*transition: opacity .1s;*/
        }
        .demo-spin-icon-load{
            animation: ani-demo-spin 1s linear infinite;
        }
        @keyframes ani-demo-spin {
            from { transform: rotate(0deg);}
            50%  { transform: rotate(180deg);}
            to   { transform: rotate(360deg);}
        }
        /*其它*/
        .ivu-tabs-bar{
            margin-bottom: 0px;
        }
        /*缓冲高度*/
        .ivu-spin-fix{
            height: 1350px;
        }
        .ivu-table-border th{
            text-align: center;
        }
        .ivu-table-row>td{
            text-align: center;
        }
        /*最晚出票时限标红*/
        div[data-deadlineTime='1']{
            color: red;
        }
    </style>
</head>
<body>
<div id="artificialDom" style="min-height: 1000px">
    <div>
        <!--日志-->
        <log-Dom  v-if="logar"></log-Dom>
        <!--拆分-->
        <split v-if="splitFlag"></split>
        <!--动画-->
        <!--<Col class="demo-spin-col" span="8">-->
        <!--<Spin fix v-if="animaFlag">-->
            <!--<Icon type="ios-loading" size=18 class="demo-spin-icon-load"></Icon>-->
            <!--<div>Loading</div>-->
        <!--</Spin>-->
        <!--</Col>-->
        <!--主体table-->
        <Tabs v-model="name"
              :animated="false"
              @on-click="tabChange"
              style="min-height: 1000px">
            <Tab-pane label="自动出票中" name="name1">
                <ticketing v-if="name=='name1'"></ticketing>
            </Tab-pane>
            <Tab-pane label="未锁定" name="name2">
                <artificial v-if="name=='name2'"></artificial>
            </Tab-pane>
            <Tab-pane label="已锁定" name="name3">
                <artificial-Unlock v-if="name=='name3'"></artificial-Unlock>
            </Tab-pane>
            <Tab-pane label="异常单" name="name4">
                <abnormal-order v-if="name=='name4'"></abnormal-order>
            </Tab-pane>
            <Tab-pane label="客服异常单" name="name5">
                <server v-if="name=='name5'"></server>
            </Tab-pane>
        </Tabs>
    </div>
</div>
<!--自动出票中-->
<template id="ticketing">
    <div style="margin-top: -6px">
        <div  style="padding:5px;">
            <div>
                <div v-if="searchFlag" class="ticketingChoose">
                    <!--航司-->
                    <i-input class="chooseChild" v-model="chooseObj.fly">
                        <span slot="prepend">航司</span>
                    </i-input>
                    <!--其他参数模糊查询-->
                    <i-input class="chooseChild" v-model="chooseObj.other">
                        <span slot="prepend">其他参数模糊查询</span>
                    </i-input>
                    <!--支付日期-->
                    <div style="margin-top: 14px;margin-left: 7px;">起飞日期:</div>
                    <div style="margin-top: 11px">
                        <Date-picker type="daterange"
                                     v-model="chooseObj.FlyTime"
                                     placement="bottom-end"
                                     placeholder="起飞日期"
                                     @on-change="flyTimeFun"
                                     style="width: 200px;display: block;">
                        </Date-picker>
                    </div>
                    <!--状态-->
                    <div style="color:black;margin-top: 14px;margin-left: 10px">状态:</div>
                    <div style="margin-top: 11px">
                        <select class="chooseChildA selectDom" v-model="chooseObj.status">
                            <option value="0">全部</option>
                            <option value="淘宝9C">淘宝9C</option>
                            <option value="去哪儿">去哪</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="ticketingChoose">
                <!--小PNR-->
                <i-input class="chooseChild" v-model="chooseObj.smartNumber">
                    <span slot="prepend">小PNR</span>
                </i-input>
                <!--票号模糊查询-->
                <i-input class="chooseChild" v-model="chooseObj.ticketNum">
                    <span slot="prepend">票号模糊查询</span>
                </i-input>
                <!--订票账号模糊查询-->
                <i-input class="chooseChild" v-model="chooseObj.account">
                    <span slot="prepend">订票账号模糊查询</span>
                </i-input>
                <!--平台选择-->
                <div style="color:black;margin-top: 15px">平台选择:</div>
                <div>
                    <div style="margin-top: 12px">
                        <select class="chooseChildA selectDom" v-model="chooseObj.ticketTable">
                            <option value="">全部</option>
                            <option value="淘宝9C">淘宝9C</option>
                            <option value="去哪儿">去哪</option>
                        </select>
                    </div>
                </div>
                <!--确认筛选条件-->
                <div style="width: 65px;margin-top: 12px;margin-left: 20px">
                    <div class="buttThree" @click="chooseFun">确认筛选</div>
                </div>
            </div>
            <table class="ariticialTalbe" style="font-size: 12px;width: 100%;">
                <colgroup>
                    <col style="width:7%"><!--操作-->
                    <col style="width:4%"><!--平台-->
                    <col style="width:5%"><!--平台-->
                    <col style="width:auto"><!--订票账号-->
                    <col style="width:200px"><!--航班信息-->
                    <col style="width:4%"> <!--小编码-->
                    <col style="width:auto"><!--订单号-->
                    <col style="width:7%"><!--余位-->
                    <col style="width:8%"><!--进单时长-->
                    <col style="width:5%"><!--收付款	-->
                    <col style="width:6%"><!--状态-->
                    <col style="width:15%"><!--平台状态-->
                </colgroup>
                <thead >
                <tr style="text-align:center;height: 40px" class="headBorder">
                    <th style="padding: 1px">
                        <div>
                            <span>操作</span>
                        </div>
                    </th>
                    <th>
                        <div>
                            <span>平台</span>
                        </div>
                    </th>
                    <!--操作人-->
                    <th>操作人</th>
                    <th style="text-align:center">
                        <div class="search" @click="closeSearch">
                            <span>订票账号</span>
                        </div>

                    </th>
                    <th>航班信息</th>
                    <th>小编码</th>
                    <th style="padding: 1px">订单号</th>
                    <th>余位</th>
                    <th>进单时长(分钟)</th>
                    <th>收付款</th>
                    <th>状态</th>
                    <th>平台状态</th>
                </tr>
                </thead>
                <tbody class="ariticialTalbeChild ticketing" >
                <tr v-for="(ele,index) in ticketingObj" :key="ele.id" style="height: 60px" >
                    <!--处理按钮-->
                    <td>
                        <button class="butt"  @click="abnormalfun(ele.id)">人工处理</button>
                    </td>
                    <!--平台-->
                    <td>
                        <div>{{ele.ticketTable}}</div>
                    </td>
                    <!--操作人-->
                    <td>
                        <div>{{ele.drawer}}</div>
                    </td>
                    <!--订票账号-->
                    <td>
                        <div>{{ele.yb_num}}</div>
                    </td>
                    <!--航班信息-->
                    <td>
                        <div class="td_message">
                            <div>{{ele.flight}}</div>
                            <div>{{ele.start}}-{{ele.arr}}</div>
                            <div>{{ele.population}}</div>
                            <div>{{ele.flyTime | timeFilter}}</div>
                            <div style="color: red">{{ele.realFlyTime}}</div>
                            <div>{{ele.position}}</div>
                        </div>
                    </td>
                    <!--小编码-->
                    <td>
                        <div>{{ele.smartNumber}}</div>
                    </td>
                    <!--订单号-->
                    <td>
                        <div>{{ele.platformOrder}}</div>
                    </td>
                    <!--余位-->
                    <td>
                        <div :class="ele.isRed?'red':''">{{ele.cabin_and_site}}</div>
                    </td>
                    <!--进单时长-->
                    <td>
                        <div>{{ele.Time_len}}</div>
                    </td>
                    <!--收付款-->
                    <td>
                        <div>{{ele.collection}}</div>
                        <div>{{ele.pay}}</div>
                    </td>
                    <!--状态-->
                    <td>
                        <div>{{ele.status | statusFilter}}</div>
                    </td>
                    <!--平台状态-->
                    <td>
                        <div>{{ele.platformStatus}}</div>
                    </td>
                </tr>
                </tbody>
            </table>
            <not-data v-if="notDataFlag" :not-data-text="notDataText"></not-data>
            <!--分页逻辑-->
            <div style="float: right;margin-top: 20px">
                <button type="button"  class=""  @click="firstpage">第一页</button>
                <button type="button"  class=""  @click="uppage">前一页</button>
                共<span>{{pages}}</span>页&nbsp;&nbsp;
                第&nbsp;<input type="text" style="width:40px;height:22px;padding:5px;display: inline;font-size: .9em;" :value="num" ref="num">&nbsp;页&nbsp;&nbsp;
                <button  class=""  @click="gotopage">转到</button>
                <button  class=""  @click="downpage">后一页</button>
                <button  class=""  @click="llastpage">最后一页</button>
            </div>
        </div>
    </div>
</template>
<!--未锁单-->
<template id="artificial">
    <div style="margin-top: 6px">
        <choose v-if="searchFlag"
                    @chooselock="chooselock"
                    @conditionsfun="conditionsFun"
                    :conditionsFlag="conditionsFlag"
            >
            </choose>
        <conditions
                v-if="conditionsFlag"
                @conditionsfun="conditionsFun"
                @choosefun="choosefun"
        >
        </conditions>
        <!--</transition>-->
        <div class="fuzhiDom">
            <input type="text" class="fuzhiId" ref="copy">
        </div>
        <div>
            <div>
                <!--table上方的按钮-->
                <div class="gray">
                    <i-button size="small" type="primary" class="i_butt" @click="three">锁定前3单</i-button>
                    <i-button size="small" class="i_butt" @click="lotSize">批量锁定</i-button>
                    <i-button size="small" type="success" class="i_butt" @click="searchFlagFun">搜索</i-button>
                    <!--<div class="searchDom" @click="searchFlagFun"></div>-->
                </div>
                <!--table-->
                <div  style="padding:5px;">
                    <table class="ariticialTalbe" style="font-size: 12px;width: 100%">
                        <colgroup>
                            <col style="width:5%"><!--全选-->
                            <col style="width:4%"><!--订单处理-->
                            <col style="width:7%"><!--票台-->
                            <col style="width:16%"><!--政策代码-->
                            <col style="width:10%"> <!--航班信息-->
                            <col style="width:4%;"><!--时长-->
                            <col style="width:auto"><!--订单号-->
                            <col style="width:auto"><!--订单号-->
                            <col style="width:70px"><!--余位-->
                            <col style="width:5%"><!--收付款	-->
                            <col style="width:6%"><!--备注-->
                        </colgroup>
                        <thead >
                        <tr style="text-align:center;height: 40px" class="headBorder">
                            <th style="padding: 1px">
                                <div>
                                    <input type="checkbox"  @click='allInp' id="allcheck">
                                    <span>全选</span>
                                </div>
                            </th>
                            <th>
                                <div>
                                    <span>订单</span>
                                </div>
                            </th>
                            <th style="text-align:center">票台</th>
                            <th>政策代码</th>
                            <th>航班信息</th>
                            <th style="padding: 1px">时长</th>
                            <th>订单号</th>
                            <th>最晚出票时限</th>
                            <th>余位</th>
                            <th>收付款</th>
                            <th>备注</th>
                        </tr>
                        </thead>
                        <tbody class="ariticialTalbeChild" >
                        <tr v-for="(ord,index) in or" :key="ord.id" :data-color="ord.mode==0?'color':false" style="height: 60px">
                            <td>
                                <i-button size="small" class="i_butt"  @click="locKfun(ord.aircompany_str,ord.id)">锁单</i-button>
                                <!--<button v-else-if="ord.isAssociation=='1'?true:false"  class="butt"  @click="lienFun(ord.aircompany_str,ord.id)">关联锁单</button>-->
                                <label>
                                    <div>
                                        <input  type="checkbox" @click='onlyInputCheck(ord.id)' ref="inputDom">
                                        {{index+1}}
                                    </div>
                                </label>
                            </td>
                            <td>
                                <div v-if="ord.mode==0?false:ord.aircompany_str=='9C'?true:false">
                                    <i-button class="i_butt" @click="replacefun(ord.id)">重订</i-button>
                                    <i-button class="i_butt" @click="repay(ord.id)">重付</i-button>
                                </div>
                            </td>
                            <!--票台-->
                            <td>
                                <div>{{ord.ticketTable}}</div>
                            </td>
                            <!--政策代码与个人备注-->
                            <td>
                                <div v-if="ord.orderMarkes||ord.aircompany_str == 'PN'||ord.aircompany_str == 'GS'||ord.aircompany_str == 'UQ'" >
                                    <div style="width: 100%;">
                                        <div>{{ord.policyCode}}&emsp;{{ord.policyPerson}}</div>
                                        <div>{{ord.policy_code_smart}}</div>
                                    </div>
                                    <div style="height: 20px;overflow: hidden;color:red" :title="ord.orderMarkes">
                                        {{ord.orderMarkes}}
                                    </div>
                                </div>
                                <div v-else>
                                    <div>
                                        <div>{{ord.policyCode}}&emsp;{{ord.policyPerson}}</div>
                                    </div>
                                </div>
                            </td>
                            <!--航班信息-->
                            <td>
                                <div :data-red="ord.red" class="td_message">
                                    <div>{{ord.flight}}</div>
                                    <div>{{ord.flyDistance}}</div>
                                    <div>{{ord.population}}</div>
                                    <div>{{ord.flyTime}}</div>
                                    <div style="color: red">{{ord.realFlyTime}}</div>
                                    <div>{{ord.position}}</div>
                                </div>
                            </td>
                            <!--时长-->
                            <td>
                                <div :data-redTime="ord.red_time">{{ord.orderTime}}</div>
                            </td>
                            <!--订单号-->
                            <td class="chaFather">
                                <div class="cha" title="出票失败返回" v-if="ord.isdone==0?false:true"></div>
                                <div @click="locKfuntwo(ord.id)" title="访客模式" class="textHover">{{ord.id}}</div>
                                <div style="display: inline-block" @dblclick="dblcli" title="日志" @click="orderUp(ord.id)" class="curspointertwo" :data-cc="ord.id">{{ord.platformOrder}}</div>
                                <div class="fuzhi" title="复制订单号" @click="fuzhifun(ord.platformOrder)"></div>
                            </td>
                            <!--最晚出票时限-->
                            <td>
                                <div :data-deadlineTime="ord.data_deallineRed" title="最晚出票时限">{{ord.deadline}}</div>
                            </td>
                            <!--余位-->
                            <td :data-cursite="ord.cursiteColor">
                                <div :data-cursite="ord.cursiteColor">{{ord.cursite | yuwei}}</div>
                                <div :data-cursite="ord.cursiteColor">{{ord.cursite | yuwei2}}</div>
                            </td>
                            <!--收付款-->
                            <td>
                                <div>{{ord.collection}}</div>
                                <div>{{ord.pay}}</div>
                            </td>
                            <!--备注-->
                            <td>
                                <div :title="ord.remarks" style="height: 50px;overflow: hidden;width: 150px;">{{ord.remarks}}</div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <not-data v-if="notDataFlag" :not-data-text="notDataText"></not-data>
                    <!--分页逻辑-->
                    <div style="float: right;margin-top: 20px">
                        <button type="button"  class=""  @click="firstpage">第一页</button>
                        <button type="button"  class=""  @click="uppage">前一页</button>
                        共<span>{{pages}}</span>页&nbsp;&nbsp;
                        第&nbsp;<input type="text" style="width:40px;height:22px;padding:5px;display: inline;font-size: .9em;" :value="num" ref="num">&nbsp;页&nbsp;&nbsp;
                        <button  class=""  @click="gotopage">转到</button>
                        <button  class=""  @click="downpage">后一页</button>
                        <button  class=""  @click="llastpage">最后一页</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
<!--已锁单-->
<template id="artificialUnlock">
    <div style="margin-top: 6px">
        <!--复制dom-->
        <div class="fuzhiDom">
            <input type="text" class="fuzhiId" ref="copy">
        </div>
        <!--搜索条件框-->
        <choose v-if="searchFlag"
        @chooselock="chooselock"
        @conditionsfun="conditionsFun"
        ></choose>
        <!--具体条件筛选框-->
        <conditions
                     v-if="conditionsFlag"
                     @conditionsfun="conditionsFun"
                     @choosefun="choosefun"
        ></conditions>
        <!--批量解锁 搜索 个人锁单三个快捷键-->
        <div class="gray">
            <i-button size="small" class="i_butt" @click="lotSizeLock">批量解锁</i-button>
            <i-button size="small" type="success" class="i_butt" @click="searchFlagFun">搜索</i-button>
            <i-button size="small" type="primary" class="i_butt" @click='onelockshow'>个人锁单</i-button>
        </div>
        <!--主体table-->
        <div class="">
            <!--主体展示dom-->
            <table class="ariticialTalbe" style="font-size: 12px;width: 100%">
                <colgroup>
                    <col  style="width:40px"><!--序号-->
                    <col  style="width:50px"><!--处理方式-->
                    <col  style="width:60px"><!--处理人-->
                    <col  style="width:50px;"><!--票台-->
                    <col  style="width:auto"><!--政策代码-->
                    <col><!--航班信息-->
                    <col  style="width:45px"><!--时长-->
                    <col  style="width:auto"><!--订单号-->
                    <col  style="width:70px"><!--收款	-->
                    <col  style="width:100px"><!--支付-->
                    <!--<col  style="width:50px">&lt;!&ndash;票号&ndash;&gt;-->
                    <col  style="width:70px"><!--余位-->
                    <col  style="width:65px"><!--平台状态	-->
                    <col  style="width:65px"><!--航司状态-->
                    <col  style="width:100px"><!--备注-->
                </colgroup>
                <thead>
                <tr class="headBorder" style="height: 60px">
                    <th style="padding: 1px;width: 40px">
                        <div>
                            <input type="checkbox" @click="allInpLock"  id="allcheck_lock">
                        </div>
                        <div>
                            <span>全选</span>
                        </div>
                    </th>
                    <th>处理</th>
                    <th>处理人</th>
                    <th>票台</th>
                    <th>政策代码</th>
                    <th>航班信息</th>
                    <th>时长</th>
                    <th>订单号</th>
                    <th>收款/支付</th>
                    <th>票号回帖</th>
                    <!--<th>票号</th>-->
                    <th>余位</th>
                    <th>平台状态</th>
                    <th>航司状态</th>
                    <th>备注</th>

                </thead>
                <tbody class="ariticialTalbeChild" >
                <tr v-for="(ord,index,key) in orLock" :data-cc="ord.show">
                    <td>
                        <div>
                            <label>
                                <!--<Checkbox  v-if="ord.permission" @on-change="addInputId(ord.id,event)" ref="inputDom"></Checkbox>-->
                                <input  type="checkbox"  @click="addInputId(ord.id)" :data-cc="ord.id" v-if="ord.permission" ref="inputDom">
                                {{index + 1}}
                            </label>
                        </div>
                        <i-button size="small" class="i_butt" @click="jiesuo(ord.id)" v-if="ord.permission" style="margin-top: 10px">解锁</i-button>
                    </td>
                    <td>
                        <div v-if="ord.permission">
                            <!--预定==重订-->
                            <div v-if="ord.aircompany_str=='9C'||ord.aircompany_str=='PN'||ord.aircompany_str=='GS'||ord.aircompany_str=='CA'||ord.aircompany_str=='TV'||ord.aircompany_str=='QW'">
                                <i-button
                                        size="small"
                                        class="i_butt"
                                        @click="replacefun(ord.id)"
                                        >重订</i-button>
                                <!--当航司为CA 则换号不出现-->
                                <i-button size="small" class="i_butt" @click="changerestart(ord.id)" v-if="ord.aircompany_str!='CA'||ord.aircompany_str!='TV'">换号</i-button>
                                <!--支付==重付-->
                                <i-button size="small" class="i_butt" @click="repay(ord.id)" >重付</i-button>
                            </div>
                            <div v-if="ord.aircompany_str=='PN'||ord.aircompany_str=='GS'||ord.aircompany_str=='TV'">
                                <i-button size="small" class="i_butt" @click="returnOrdFun(ord.id,ord.aircompany_str)">重回</i-button>
                            </div>
                            <i-button size="small" class="i_butt" v-if="ord.population>1?true:false||ord.Interconnection==2?true:false" @click="BreakUpFun(ord.id,ord.collection)">拆分</i-button>
                        </div>
                    </td>
                    <td>
                        <div v-if="ord.permission">
                            <i-button v-if="ord.aircompany_str=='9C'?true:false" size="small" class="i_butt" @click="order_green(ord.id)">绿翼预定</i-button>
                            <i-button size="small" class="i_butt" @click="chupiao(ord.id)" :data-cc="ord.id" >出票</i-button>
                            <i-button v-if="ord.aircompany_str=='9C'?true:false" size="small" class="i_butt" @click="order_greenSure(ord.id,ord.greenuser,ord.ticketNum)">绿翼支付</i-button>
                        </div>
                        <div v-else>{{ord.dealpeople}}</div>
                    </td>
                    <!--票台-->
                    <td>{{ord.ticketTable}}</td>
                    <!--政策代码-->
                    <td>
                        <div>{{ord.policyCode}}</div>
                        <div>{{ord.policy_code_smart }}</div>
                        <div style="display: inline-block">{{ord.policyPerson}}</div>
                        <div v-if="ord.orderMarkes" :title="ord.orderMarkes" style="display: inline-block;height:18px;width: 90px;overflow: hidden;color: red;display: inline-block">
                            {{ord.orderMarkes}}
                        </div>
                    </td>
                    <!--航班信息-->
                    <td>
                        <div :data-red="ord.red" class="td_message">
                            <div>{{ord.flight}}</div>
                            <div>{{ord.flyDistance}}</div>
                            <div>{{ord.population}}</div>
                            <div>{{ord.flyTime}}</div>
                            <div style="color: red">{{ord.realFlyTime}}</div>
                            <div>{{ord.position}}</div>
                        </div>
                    </td>
                    <!--时长  =="酷讯"-->
                    <td>
                        <div :data-redTime="ord.red_time">{{ord.orderTime}}</div>
                    </td>
                    <!--订单号-->
                    <td>
                        <div @click="locKfuntwo(ord.id)" class="textHover" title="访客模式" >{{ord.id}}</div>
                        <div style="display: inline-block;" @dblclick="dblcli" @click="orderUp(ord.id)" title="日志" class="curspointertwo" :data-cc="ord.id" >{{ord.platformOrder}}</div>
                        <div class="fuzhi" title="复制订单号" @click="fuzhifun(ord.platformOrder)"></div>
                    </td>
                    <!--收款付款-->
                    <td>
                        <div>{{ord.collection}}</div>
                        <input type="text" :class="ord.id" placeholder="金额" style="width: 100%;height: 17px"  v-model="ord.pay" v-if="ord.pay">
                        <input type="text" :class="ord.id" placeholder="金额" style="width: 100%;height: 17px"  v-model="ord.cash" v-else-if="ord.cash">
                    </td>
                    <!--票号回帖-->
                    <td>
                        <div v-if="ord.aircompany_str == '9C'&&ord.permission?true:false&&ord.ticketTable=='平安淘宝'" style="display: inline-block">
                        <!--<div style="display: inline-block">-->
                            <input type="text" :class="ord.id" placeholder="票号" style="width: 100%;height: 17px" v-model="ord.ticketNum">
                        </div>
                        <div v-if="ord.aircompany_str == '9C'&&ord.permission?true:false&&ord.ticketTable=='平安淘宝'" style="display: inline-block">
                        <!--<div style="display: inline-block">-->
                            <!--i-button size="small" class="i_butt"-->
                            <i-button size="small" class="i_butt" @click="returnNum(ord.pay,ord.ticketNum,ord.id)">回帖</i-button>
                        </div>
                        <div v-if="(ord.aircompany_str == '9C'||ord.aircompany_str=='PN')&&ord.permission?true:false&&ord.ticketTable=='去哪儿'" style="display: inline-block">
                        <!--<div style="display: inline-block">-->
                            <i-button size="small" class="i_butt"  @click="removeId(ord.policyCode,ord.aircompany_str)">拉黑</i-button>
                        </div>
                    </td>
                    <!--余位-->
                    <td :data-cursite="ord.cursiteColor">
                        <div :data-cursite="ord.cursiteColor">{{ord.cursite | yuwei}}</div>
                        <div :data-cursite="ord.cursiteColor">{{ord.cursite | yuwei2}}</div>
                    </td>
                    <!--平台状态-->
                    <td :title="ord.platformStatus">
                        <div style="height: 30px;overflow: hidden;width: 65px;line-height: 30px;text-align: center; vertical-align:middle;">{{ord.platformStatus}}</div>
                        <div :data-deadlineTime="ord.data_deallineRed" title="最晚出票时限">{{ord.deadline}}</div>
                    </td>
                    <!--航司状态-->
                    <td>
                        {{ord.airlineStatus}}
                    </td>
                    <td>
                        <div :title="ord.remarks" style="height: 50px;overflow: hidden;width: 100px">{{ord.remarks}}</div>
                    </td>
                </tr>
                </tbody>
            </table>
            <not-data v-if="notDataFlag" :not-data-text="notDataText"></not-data>
            <!--分页逻辑-->
            <div style="float: right;margin-top: 20px">
                <button type="button"  class=""  @click="firstpage">第一页</button>
                <button type="button"  class=""  @click="uppage">前一页</button>
                共<span>{{pages}}</span>页&nbsp;&nbsp;
                第&nbsp;<input type="text" style="width:40px;height:22px;padding:5px;display: inline;font-size: .9em;" :value="num" ref="num">&nbsp;页&nbsp;&nbsp;
                <button  class=""  @click="gotopage">转到</button>
                <button  class=""  @click="downpage">后一页</button>
                <button  class=""  @click="llastpage">最后一页</button>
            </div>
        </div>
    </div>
</template>
<!--异常单-->
<template id="abnormalOrder">
    <div>
        <div  style="padding:1px;margin-top: -2px">
            <choose v-if="abnormalSearchFlag"
                    @chooselock="chooselock"
                    @conditionsfun="conditionsFun"
            ></choose>

            <conditions
                    v-if="conditionsFlag"
                    @conditionsfun="conditionsFun"
                    @choosefun="choosefun"
            ></conditions>

            <i-button size="small" class="i_butt"  type="primary" @click="abnormalAlotOfUnlockFun">批量解锁</i-button>
            <i-button size="small" class="i_butt" type="primary" @click="abnormalAloneLockFun">个人锁单</i-button>
            <i-button size="small" class="i_butt" @click="abnormalSearchFlagFun">搜索</i-button>
            <table>
                <colgroup>
                    <col style="width:8%"><!--全选-->
                    <col style="width:auto"><!--处理-->
                    <col style="width:auto"><!--票台-->
                    <col style="width:auto"><!--政策代码-->
                    <col style="width:auto"><!--航班信息-->
                    <col style="width:auto"><!--进单日期-->
                    <col style="width:auto"><!--订单号-->
                    <col style="width:auto"><!--收付款-->
                    <col style="width:80px"><!--余位情况-->
                    <col style="width:auto"><!--平台状态-->
                    <col style="width:150px"><!--备注-->
                    <col style="width:auto"><!--订单备注-->
                    <col style="width:auto"><!--是否抢单中-->
                </colgroup>
                <thead >
                <tr style="text-align:center;height: 40px" class="headBorder">
                    <th style="padding: 1px">
                        <label>
                            <input type="checkbox" @click="abnormalAlotOfLock" id="abnormalAlotOfInputId">
                            <span>全选</span>
                        </label>
                    </th>
                    <th>处理</th>
                    <th>票台</th>
                    <th style="text-align:center">政策代码</th>
                    <th>航班信息</th>
                    <th>进单日期</th>
                    <th>订单号</th>
                    <th>收付款</th>
                    <th>余位情况</th>
                    <th>平台状态</th>
                    <th>备注</th>
                    <th>订单备注</th>
                    <th>是否抢单中</th>
                </tr>
                </thead>
                <tbody class="ariticialTalbeChild ticketing" >
                <tr v-for="(ord,index) in abnormalObj" :key="ord.id" style="height: 60px">
                    <!--单选-->
                   <td>{{ord.id}}
                       <input type="checkbox" class="abnormalAloneInp" :data-id="ord.id" @click="abnormalOrderAloneInp">
                   </td>
                    <!--处理-->
                    <td>
                        <div v-if="ord.dealpeople==ord.now_dealpeople?true:false">
                            <i-button type="info" class="i_butt" size="small" @click="abnormalDealOrderFun(ord.id)">出票</i-button>
                            <i-button type="success" class="i_butt" size="small" @click="abnormalUnLock(ord.id)">解锁</i-button>
                        </div>
                        <div v-else>
                            <div>{{ord.dealpeople}}</div>
                            <i-button type="success" size="small" class="i_butt" @click="abnormalUnLock(ord.id)">解锁</i-button>
                        </div>
                    </td>
                    <!--票台-->
                    <td>{{ord.ticketTable}}</td>
                    <!--政策代码-->
                    <td>{{ord.policyCode}}</td>
                    <!--航班信息-->
                    <td>
                        <div class="td_message">
                            <div>{{ord.flight}}</div>
                            <div>{{ord.dep_airport}}-{{ord.arr_airport}}</div>
                            <div>{{ord.population}}</div>
                            <div>{{ord.flyTime}}</div>
                            <div style="color: red">{{ord.realFlyTime}}</div>
                            <div>{{ord.position}}</div>
                        </div>
                    </td>
                    <!--进单日期-->
                    <td>{{ord.orderTime}}</td>
                    <!--订单号-->
                    <td>{{ord.platformOrder}}</td>
                    <!--收付款-->
                    <td>
                        {{ord.collection}}
                        {{ord.pay}}
                    </td>
                    <!--余位情况-->
                    <td>
                        <div :title="ord.cursite"  style="height: 50px;overflow: hidden;width: 80px;line-height: 50px;">
                            {{ord.cursite}}
                        </div>
                    </td>
                    <!--平台状态-->
                    <td>{{ord.platformStatus}}</td>
                    <!--备注-->
                    <td >
                        <div :title="ord.remarks"  style="height: 50px;overflow: hidden;width: 150px">{{ord.remarks}}</div>
                    </td>
                    <!--订单备注-->
                    <td>{{ord.orderMarkes}}</td>
                    <!--是否抢单中-->
                    <td>{{ord.is_grab | is_grabFilter}}</td>
                </tr>
                </tbody>
            </table>
            <not-data v-if="notDataFlag" :not-data-text="notDataText"></not-data>
            <!--分页逻辑-->
            <div style="float: right;margin-top: 20px">
                <button type="button"  class=""  @click="firstpage">第一页</button>
                <button type="button"  class=""  @click="uppage">前一页</button>
                共<span>{{pages}}</span>页&nbsp;&nbsp;
                第&nbsp;<input type="text" style="width:40px;height:22px;padding:5px;display: inline;font-size: .9em;" :value="num" ref="num">&nbsp;页&nbsp;&nbsp;
                <button  class=""  @click="gotopage">转到</button>
                <button  class=""  @click="downpage">后一页</button>
                <button  class=""  @click="llastpage">最后一页</button>
            </div>
        </div>
    </div>
</template>
<!--客服异常单-->
<template id="server">
    <div>
        <div  style="padding:1px;margin-top: -2px">
            <table class=" server" style="font-size: 12px;width: 100%">
                <colgroup>
                    <col style="width:8%"><!--全选-->
                    <col style="width:auto"><!--平台-->
                    <col style="width:auto"><!--订单号-->
                    <col style="width:auto"><!--进单时长-->
                    <col style="width:auto"><!--平台状态-->
                    <col style="width:auto"><!--备注-->
                </colgroup>
                <thead >
                <tr style="text-align:center;height: 40px" class="headBorder">
                    <th style="padding: 1px">
                        <span>操作</span>
                    </th>
                    <th>
                        <div>
                            <span>平台</span>
                        </div>
                    </th>
                    <th style="text-align:center">订单号</th>
                    <th>进单时长</th>
                    <th>平台状态</th>
                    <th>亏损备注</th>
                </tr>
                </thead>
                <tbody class="ariticialTalbeChild ticketing" >
                <tr v-for="(ord,index) in serverObj" :key="ord.id" style="height: 60px">
                    <!--处理按钮-->
                    <td>
                        <button v-if="ord.dealpeople==this.person" class="butt"  @click="abnormalServerfun(ord.id)">处理</button>
                        <button v-else-if="ord.dealpeople=='客服异常'" class="butt"  @click="abnormalServerfun(ord.id)">客服异常</button>
                        <div v-else >{{ord.dealpeople}}</div>
                    </td>
                    <!--平台-->
                    <td>
                        <div>{{ord.ticketTable}}</div>
                    </td>
                    <!--订单号-->
                    <td>
                        <div>{{ord.platformOrder}}</div>
                    </td>
                    <!--进单时长-->
                    <td>
                        <div>{{ord.Time_len}}</div>
                    </td>
                    <!--平台状态-->
                    <td>
                        <div>{{ord.platformStatus }}</div>
                    </td>
                    <!--亏损备注-->
                    <td>
                        <div>{{ord.orderMarkes}}</div>
                    </td>
                </tr>
                </tbody>
            </table>
            <not-data v-if="notDataFlag" :not-data-text="notDataText"></not-data>
            <!--分页逻辑-->
            <div style="float: right;margin-top: 20px">
                <button type="button"  class=""  @click="firstpage">第一页</button>
                <button type="button"  class=""  @click="uppage">前一页</button>
                共<span>{{pages}}</span>页&nbsp;&nbsp;
                第&nbsp;<input type="text" style="width:40px;height:22px;padding:5px;display: inline;font-size: .9em;" :value="num" ref="num">&nbsp;页&nbsp;&nbsp;
                <button  class=""  @click="gotopage">转到</button>
                <button  class=""  @click="downpage">后一页</button>
                <button  class=""  @click="llastpage">最后一页</button>
            </div>
        </div>
    </div>
</template>

<!--条件搜索-->
<template id="conditions">
    <div class="conditionsFlag">
        <header class="titleHead">
            <div class="headPicture"></div>
            <div style="margin-left: 44%">详细查询</div>
        </header>
        <div id="tiaojian">
            <span>查单排序条件</span>
            <Radio-Group v-model="ticketTime">
                <Radio label="1">
                    <span>进单时间</span>
                </Radio>
                <Radio label="2">
                    <span>起飞时间</span>
                </Radio>
            </Radio-Group>
        </div>
        <div id="hangsi">
            <span>选择航空公司</span>
            <div style="display: inline-block">
                <Icon type="ios-paper-plane" size="10px"/>
            </div>
            <div style="border-bottom: 1px solid #e9e9e9;padding-bottom:6px;margin-bottom:6px;">
                <Checkbox
                        :indeterminate="airlineIndeterminate"
                        :value="airlineCheckAll"
                        @on-change="airlineCheckAllFun">全选</Checkbox>
            </div>
            <Checkbox-Group v-model="airlineGroup" @on-change="airlineGroupChange">
                <Checkbox :label="ele" v-for="(ele,index) in airline" :key="ele"></Checkbox>
            </Checkbox-Group>
        </div>
        <div id="pingtai">
            <span>选择平台</span>
            <div style="display: inline-block">
                <Icon type="ios-home" size="15px"/>
            </div>
            <div style="border-bottom: 1px solid #e9e9e9;padding-bottom:6px;margin-bottom:6px;">
                <Checkbox
                        :indeterminate="tableIndeterminate"
                        :value="tableCheckAll"
                        @on-change="tableCheckAllFun" ref="">全选</Checkbox>
            </div>
            <Checkbox-Group v-model="tableCheckGroup" @on-change="tableCheckGroupChange">
                <Checkbox :label="ele" v-for="(ele,index) in tableGroup" :key="ele" :value="index"></Checkbox>
            </Checkbox-Group>
        </div>
        <div id="last">
            <!--<div >-->
                <!--<div style="border-bottom: 1px solid #e9e9e9;padding-bottom:6px;margin-bottom:6px;">-->
                    <!--<Checkbox-->
                            <!--:indeterminate="AllIndeterminate"-->
                            <!--:value="AllValue"-->
                            <!--@on-change="AllCheckGroupFun">全选</Checkbox>-->
                <!--</div>-->
            <!--</div>-->

            <button @click="choosefun">确定筛选</button>
            <button @click="conditionsFun">返回</button>
        </div>
    </div>
</template>
<!--普通搜索-->
<template id="choosetem">
    <div id="choose">
        <div class="chooseOne">
            <!--航司选择框-->
            <div>
                <div style="color:black">航司选择</div>
                <i-select class="chooseInput"  filterable v-model="aircompany_str">
                    <i-option value="">全部</i-option>
                    <i-option value="3U">3U</i-option>
                    <i-option value="9C">9C</i-option>
                    <i-option value="AQ">AQ</i-option>
                    <i-option value="ZH">ZH</i-option>
                    <i-option value="MF">MF</i-option>
                    <i-option value="CA">CA</i-option>
                    <i-option value="BK">BK</i-option>
                    <i-option value="HO">HO</i-option>
                    <i-option value="EU">EU</i-option>
                    <i-option value="SC">SC</i-option>
                    <i-option value="KY">KY</i-option>
                    <i-option value="NS">NS</i-option>
                    <i-option value="QW">QW</i-option>
                    <i-option value="TV">TV</i-option>
                    <i-option value="G5">G5</i-option>
                    <i-option value="DZ">DZ</i-option>
                    <i-option value="UQ">UQ</i-option>
                    <i-option value="GJ">GJ</i-option>
                    <i-option value="JR">JR</i-option>
                    <i-option value="A6">A6</i-option>
                    <i-option value="GY">GY</i-option>
                    <i-option value="RY">RY</i-option>
                </i-select>
            </div>
            <!--平台选择-->
            <div>
                <div>
                    <div style="color:black">平台选择</div>
                    <i-select class="chooseInput" v-model="ticketTable">
                        <i-option value="">全部</i-option>
                        <i-option value="淘宝9C">淘宝9C</i-option>
                        <i-option value="去哪儿">去哪</i-option>
                        <i-option value="携程">携程</i-option>
                        <i-option value="携程直连">携程直连</i-option>
                        <i-option value="酷讯">酷讯</i-option>
                        <i-option value="淘宝B平台">淘宝B平台</i-option>
                        <i-option value="同程">同程</i-option>
                        <i-option value="八千翼">八千翼</i-option>
                        <i-option value="平安淘宝">平安淘宝</i-option>
                        <i-option value="去哪儿pai">去哪儿pai</i-option>
                    </i-select>
                </div>
            </div>
            <!--日期选择框-->
            <div>
                <div>支付日期</div>
                <div id="datepicker">
                    <Date-picker v-model="payTime"
                                 type="daterange"
                                 placement="bottom-end"
                                 placeholder="支付日期"
                                 @on-change="payTimeFun"
                                 @on-clear = 'flyClearFun'
                                 class="chooseInput">
                    </Date-picker>
                </div>
            </div>
            <!--起飞日期-->
            <div>
                <div>起飞日期</div>
                <Date-picker type="daterange"
                             v-model="flyTime"
                             placement="bottom-end"
                             placeholder="起飞日期"
                             @on-change="flyTimeFun"
                             class="chooseInput">
                </Date-picker>
            </div>
        </div>
        <div class="chooseTwo">
            <!--大PNR-->
            <i-input class="chooseChild" v-model="bigNumber">
                <span slot="prepend">大PNR</span>
            </i-input>
            <!--小PNR-->
            <i-input class="chooseChild" v-model="smartNumber">
                <span slot="prepend">小PNR</span>
            </i-input>
            <!--换大PNR-->
            <i-input class="chooseChild" v-model="big">
                <span slot="prepend">换大PNR</span>
            </i-input>
            <!--换小PNR-->
            <i-input class="chooseChild" v-model="smart">
                <span slot="prepend">换小PNR</span>
            </i-input>
            <!--乘客姓名-->
            <i-input class="chooseChild" v-model="man">
                <span slot="prepend">乘客姓名</span>
            </i-input>
            <!--平台政策代码-->
            <i-input class="chooseChild" v-model="policyCode">
                <span slot="prepend">平台政策代码</span>
            </i-input>
            <!--航班号-->
            <i-input class="chooseChild" v-model="flight">
                <span slot="prepend">航班号</span>
            </i-input>
            <!--系统订单号-->
            <i-input class="chooseChild" v-model="id">
                <span slot="prepend">系统订单号</span>
            </i-input>
            <!--平台订单号-->
            <i-input class="chooseChild" v-model="platformOrder">
                <span slot="prepend">平台订单号</span>
            </i-input>
            <!--确认筛选条件-->
            <div>
                <div class="buttThree" @click="chooselock">开始筛选</div>
            </div>
            <!--条件筛选-->
            <div v-if="name==='name4'?false:true">
                <div class="buttThree"  @click="condition">条件筛选</div>
            </div>
        </div>
    </div>
</template>
<!--日志dom-->
<template id="logDom">
    <div >
        <Modal
                v-model="logSelfFlag"
                width="680"
                draggable scrollable title="操作日志"
                @on-ok="closeLog"
                @on-cancel="closeLog"
                footer-hide
        >
            <i-Table
                    :show-header=false
                    height="380" width="650" :columns="columns1" :data="logar"></i-Table>
        </Modal>

        <!--<header class="titleHead" class="log">
            <div class="closeButt" style="float: right" @click="closeLog"></div>
            <div class="headPicture"></div>
            <div style="margin-left: 45%">操作日志</div>
        </header>
        <div>
            <template>
                <i-Table height="380" width="650" :columns="columns1" :data="logar"></i-Table>
            </template>
        </div>-->
    </div>
</template>
<!--拆分-->
<template id="split">
    <div class="splitWindow">
        <!--拆个人-->
        <div>
            <header>
                <div class="icon_split"></div>
                <div class="headertitle">拆分乘客信息</div>
                <div class="closeButt close_splitIcon" @click="BreakUpFunClose"></div>
            </header>
            <div class="splitBody">
                <table class="server" style="font-size: 12px;width: 100%">
                    <colgroup>
                        <col style="width:5%"><!--input-->
                        <col style="width:auto"><!--名字-->
                        <col style="width:auto"><!--身份证-->
                        <col style="width:auto"><!--金额-->
                    </colgroup>
                    <thead >
                    <tr style="text-align:center;height: 40px" class="headBorder">
                        <th>操作</th>
                        <th>名字</th>
                        <th>身份证</th>
                        <th>金额</th>
                    </tr>
                    </thead>
                    <tbody class="ariticialTalbeChild ticketing" >
                    <tr v-for="(ord) in personObj" :key="ord.id" style="height: 60px">
                        <!--处理按钮-->
                        <td>
                            <input type="checkbox" @click="splitAloneCheck(ord.id)" v-model="ord.che" ref="splitcheck">
                        </td>
                        <!--名字-->
                        <td>
                            <div>{{ord.man}}</div>
                        </td>
                        <!--身份证-->
                        <td>
                            <div>{{ord.licenseNumber}}</div>
                        </td>
                        <!--金额-->
                        <td>
                            <input type="text" v-model="ord.collection" style="width: 80px;border: none;text-align: center">
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="splitDeal splitButt">
                <div class="butt" @click="BreakUpFunClose">关闭</div>
                <div class="butt" @click="splitorderFun(splitButtonFlag)">{{text}}</div>
                <input type="text" v-model="totalmoney" readonly style="text-align: center;color: white">
                <span>总金额：</span>
            </div>
        </div>
    </div>
</template>
<!--暂无无数据展示栏-->
<template id="notData">
    <div>
        <Alert type="warning" show-icon>
            {{notDataText}}
            <!--暂无订单-->
            <!--<template slot="desc">-->
                <!--原因：{{notDataText}}-->
            <!--</template>-->
        </Alert>
    </div>
</template>

<script src="../vue/axios.min.js"></script>
<script src="../vue/vue-router.js"></script>
<script src="../vue/vuex.js"></script>
<script rel="stylesheet" src="../resource/iview-2.0/dist/iview.js"></script>
<script src="../bingo/js/calc.min.js"></script>
<script type="text/javascript">
    //请求地址时间戳 防止使用缓存
    let allTime = new Date().getTime();
    // 回帖指令
    Vue.directive('retunum',{
        inserted:function (el) {
            el.onclick = function(){

            }
        }
    });


    //自动出票中组件
    Vue.component('ticketing',{
        template:'#ticketing',
        data(){
            return{
                //搜索框中的显隐开关
                searchFlag:false,
                //搜索框搜索启动开关。当搜索确定按钮按下，该值为true，
                // 默认为false。作用于翻页的时候判断是否带条件翻页
                chooseFlag:false,
                //自动出票中数据承接主体
                ticketingObj:null,
            //    初始num总为1 用与翻页框中的页码数
                num:1,
            //    总页数
                pages:1,

            //    查找内容载体
                chooseObj:{
                    status:undefined,//状态
                    ticketTable:null,//平台
                    FlyTime:null,//起飞时间
                    smartyNumber:null,//小编
                    ticketNum:undefined,//票号
                    fly:null,//航司
                    other:undefined,//其它参数
                    account:undefined,//账号
                },
                //提示没有数据的文本内容
                notDataText:undefined,
                //    提示没有数据开关
                notDataFlag:false,
            }
        },
        filters:{
            statusFilter(data){
                data = data*1
                switch(data){
                    // case 0:return '预定异常';
                    // case 1:return '预定成功';
                    // case 2:return '支付异常';
                    // case 3:return '支付成功';
                    // case 4:return '自动出票';
                    // case 5:return '手工出票';
                    // case 6:return '回帖完成';
                    // case 7:return '回帖异常';
                    // case 0:return '预定成功';
                    case 1:return '预定成功等待支付';
                    // case 2:return '';
                    case 3:return '支付成功等待回帖';
                    case 4:return '自动出票';
                    case 5:return '手工出票';
                    case 6:return '回帖成功';
                    case 9:return '压位订单';
                }
            },
            timeFilter(data){
                if(data){
                    data01 = data.replace(/^[0-9]{1,2}/,'');
                    data02 = data01.replace(/:([0-9]{1,2})$/,'')
                    return data02
                }
            },
        },
        methods:{
            //搜索框内的日期改格式相关函数
            flyTimeFun(data){
                this.chooseObj.FlyTime = [data[0],data[1]]
            },
            //搜索框函数显示隐藏函数
            closeSearch(){
                this.searchFlag = !this.searchFlag;
            },
            //搜索确认按钮的函数
            chooseFun(){
                this.chooseFlag = true;
                this.$store.state.animaFlag = true;
                axios({
                    method:'post',
                    url:'../bingo/processing_order.php?action=search',
                    data:this.chooseObj
                }).then( (res)=>{
                    this.ticketingObj = res.data.list;
                    this.pages = res.data.pages;
                    //初始化请求让条件筛选ajax函数开关为false。
                    // this.choose = false;
                    //关闭动画
                    // console.log(res.data)
                    // console.log(this.ticketingObj)
                    this.$store.state.animaFlag = false;
                }).catch( (error)=> {
                    console.log(error)
                });
            },
            //页面初始请求函数
            tiketing:function(page){
                //开启动画
                this.$store.state.animaFlag = true;
                //关闭搜索按钮触发的值。
                this.chooseFlag = false;
                // this.flag = true;
                // this.num = 1;  //从锁单页面跳转过来，将num,nnum重置，避免因为两个页面使用同一个参数导致错误
                // this.nnum = '';
                axios({
                    method:'post',
                    url:'../bingo/processing_order.php?action=ProcessingOrder',
                    data:{
                        page
                    }
                }).then( (res)=>{
                    if(res.data.list.length){
                        this.ticketingObj = res.data.list;
                        this.pages = res.data.pages;
                        //初始化请求让条件筛选ajax函数开关为false。
                        this.choose = false;
                        //关闭动画
                        this.$store.state.animaFlag = false;
                        this.dataChange(res.data.list)
                    }else{
                        this.ticketingObj = res.data.list;
                        this.notDataText = "暂时没有查询到相关数据，请稍后尝试。";
                        this.notDataFlag = true;
                    }
                }).catch( (error)=> {
                    this.notDataText = error;
                    this.notDataFlag = true;
                    console.log(error)
                });
            },
            dataChange(data){
                let arr = [],arrb=[];
                for(let a=0,leng=data.length;a<leng;a++){
                    if(data[a].status == 0||data[a].status == 2||data[a].status == 5){
                        arr.push(data[a])

                    }
                    if(data[a].status == 4){
                        arrb.push(data[a])
                    }
                }
                console.log(arr)
                console.log(arrb)
            },
            //将单置为人工
            abnormalfun(id){
                // let id = ;
                axios({
                    method:'post',
                    url:'../bingo/processing_order.php?action=manualHandle',
                    data:{
                        id
                    }
                }).then( (res)=>{
                   if(res.data.res==='转人工成功'){
                       this.$store.state.name = 'name2'
                   }else{
                       alert('转人工处理失败')
                   }
                }).catch( (error)=> {
                    console.log(error)
                });
            },

            //分页函数
            //向后转页面 —
            uppage:function(){
                if(this.num>1){
                    this.num -= 1;
                }else if(this.num<1){
                    alert('没有该页码')
                }else{
                    return
                }
                this.axfun(this.num);
            },
            //向前转页面 +
            downpage:function(){
                this.num = Number(this.num); //之前的显示数字其本质为字符串导致无法数字计算
                if(this.num<this.pages){
                    this.num = this.num + 1;
                }else{
                    return
                };
                this.axfun(this.num)
            },
            //直接去某页面
            gotopage:function () {
                let val = this.$refs.num.value;
                if(val > this.pages||val<1){
                    //页数框页码重置
                    this.$refs.num.value = this.num;
                    alert('没有该页码');
                }else{
                    this.num = Math.round(this.num);
                    this.num = val;
                    this.axfun(this.num)
                }
            },
            //直接去首页
            firstpage:function () {
                //如果num已经是第一页了，就不再请求了
                if(this.num == 1){
                    return
                }
                this.num = 1;
                this.axfun(this.num)
            },
            //直接去末尾页
            llastpage:function () {
                //如果已经等于最后已页，就不再请求
                if(this.num == this.pages){
                    return
                }
                this.num = this.pages;
                this.axfun(this.num)
            },
            //跳转后把页面值传入，用来获取要跳转页面的数据，此函数为上面所有跳转函数的通用操作
            axfun:function(page){
                //根据不同的值 来做ajax不同请求 当choose为true;则搜索是开启状态，否则是关闭状态
                //若搜索为真，则直接调用搜索函数，把之前保存的搜索条件传过去；请求搜索后的结果;
                //若搜索为假，则直接调用请求函数，直接拿值；
                if(this.chooseFlag){
                    // this.chooselock(this.chooseObj,true,page)
                }else{
                    this.tiketing(page);
                }

            },
        },
        created(){
            this.tiketing(1);
        }
    });
    //出票未锁单组件
    Vue.component('artificial',{
        template:'#artificial',
        data(){
            return{
                //存放未锁单数据的集合
                or:null,
                //ajaxs请求后拿到的总页数
                pages:undefined,
                //起始页数总为1
                num:1,
                // 提示没有数据开关
                notDataFlag:false,
                //数据错误提示文本内容
                notDataText:undefined,
                //存放选中的id，其它ajax函数用次集合来锁单这些id
                lockArray:[],
            //    搜索框开关
                searchFlag:false,
            //    搜索函数是否开启，当搜索开启，此变量会作为true传入，方便翻页的时候判断
                choose:false,
            //    搜索条件存储函数,当搜索开启，此对象将拥有值，方便翻页的时候调用
                chooseObj:null,
            //    平台订单号
                platformOrder:null,
                //    条件筛选框开关
                conditionsFlag:false,

            }
        },
        methods:{
            //未锁单页面功能 触发未锁单页面并请求数据
            inpLock:function(page){
                this.$store.state.animaFlag = true;
                axios({
                    method:'post',
                    url:'../bingo/ticking.php?action=unlock',
                    data:{
                        page
                    }
                }).then( (res)=>{
                    if(res.data.list.length){
                        let or = res.data.list;

                        //酷讯时间筛选 最晚出票时限标红
                        let leng = or.length;
                        for(let i=0;i<leng;i++){
                            //酷讯时间筛选
                            if(or[i].ticketTable=="酷讯"){
                                let timeyuan = or[i].orderTime;
                                let time = timeyuan.match('m');
                                let timeA = undefined;
                                if(time){
                                    timeA = (or[i].orderTime.match(/[1-9]([0-9]*)m/))[0];
                                    timeA = (timeA.replace('m',''))*1;
                                    if((timeA-20)>=0){
                                        // 超时
                                        or[i].red_time = "red";
                                    }else{
                                        //    没超时
                                        or[i].red_time = "";
                                    }
                                }else if(timeyuan=="刚刚"){
                                    or[i].red_time = "";
                                    //    没超时
                                }else if(timeyuan=="以前"){
                                    or[i].red_time = "red";
                                    //    超时
                                }else{
                                    //    超时 h d
                                    or[i].red_time = "red";
                                }
                                timeyuan = time = timeA = null;
                            };
                            //最晚出票时限标红
                            if(or[i].deadline){
                                let time = (new Date()).getTime();
                                let data2 = (new Date(or[i].deadline)).getTime();
                                if((data2 - time)<=2*60*60*1000){
                                    or[i].data_deallineRed = 1;
                                }
                            }
                        }

                        this.or = or;
                        leng = null;
                        //
                        this.pages = res.data.pages;
                        //初始化请求让条件筛选ajax函数开关为false。
                        this.choose = false;
                        this.$store.state.animaFlag = false;
                        this.notDataFlag = false;
                    }else{
                        this.or= res.data.list;
                        this.notDataText = "暂时没有查询到相关数据，请稍后尝试。";
                        this.notDataFlag = true;
                    }
                }).catch( (error)=> {
                    this.notDataText = error;
                    this.notDataFlag = true;
                    console.log(error)
                });
            },
            //搜索框显示隐藏按钮触发函数（非记忆搜索框）
            searchFlagFun(flag){
                if(flag){
                    this.searchFlag = !this.searchFlag
                }
            },
            //搜索框确认筛选函数（非记忆搜索功能）
            chooselock(obj,choose,page,flag){
                //obj 搜索条件对象
                // choose boolean值,判断是否有翻页
                // page页数
                // flag boolean值，判断是否开启搜索框,但是这里使用这个仅仅是为了在页面初始化的时候不会
                    //开启搜索框，因为从前写的逻辑，搜索框有值，且调用，会自动开启搜索框。所以用此值来关闭。
                this.$store.state.animaFlag = true;
                //当obj传入，意味搜索打开，obj是搜索的条件;choose作为true传进来;
                let pagee = undefined;
                if(obj){
                    this.chooseObj = JSON.parse(JSON.stringify(obj));
                }
                page?pagee=page:pagee = 1;
                //如果翻页，翻页函数会通过此判断翻页是否有搜索条件
                choose?this.choose=true:this.choose=false;
                obj.page = pagee;
                obj.flag = true;
                axios({
                    method: 'post',
                    url: '../bingo/ticking.php?action=countersign',
                    data:obj
                }).then((response)=>{
                    if(response.data.list.length){
                        this.or = response.data.list;
                        this.pages = response.data.pages;
                        this.$store.state.animaFlag = false;
                        this.searchFlagFun(flag)
                    }else{
                        this.or = response.data.list;
                        this.notDataText = "暂时没有查询到相关数据，请稍后尝试。";
                        this.notDataFlag = true;
                    }
                }).catch((error)=>{
                    this.notDataText = error;
                    this.notDataFlag = true;
                    console.log(error)
                });
            },
            //条件筛选关闭函数（记忆搜索框功能）
            conditionsFun(){
                this.conditionsFlag = !this.conditionsFlag;
            },
            //条件筛选触发函数（记忆搜索功能）
            choosefun:function(choosear){   //条件筛选下的 确认筛选按钮 会筛选所有打钩的input 放入到choosear里面
                axios({
                    url:'../bingo/ticking.php?action=choose',
                    method:'post',
                    data: choosear,
                }).then((response)=>{
                    this.conditionsFlag = false;
                    this.inpLock(1)
                }).catch((error)=>{
                    console.log(error)
                })
            },
            //锁定前三张单按钮
            three:function(){
                if(this.or.length == 0){
                    alert('暂无数据')
                    return
                }
                for(let a=0;a<=2;a++){
                    //用判断是因为有的时候单没有三个单，比如两个单情况下，a为2是没有值的。
                    if(this.or[a]){
                    this.lockArray.push(this.or[a].id)
                    }
                }
                axios({
                    url:'../bingo/ticking.php?action=locking',
                    method:'post',
                    data:{
                        orderid:this.lockArray,
                        lockorder:'yes',
                    }
                }).then((response)=>{
                    if(response.data.res=='success'){
                        //锁定前三单后跳转到已锁单页面
                        this.$store.state.name = 'name3';
                    }else{
                        alert('锁单失败')
                    }
                }).catch((error)=>{
                    console.log(error)
                })
            },
            //批量锁定按钮
            lotSize:function(){
                if(this.lockArray.length){
                    var f1 = confirm('确定所选？');
                    if(f1){
                        axios({
                            url:'../bingo/ticking.php?action=locking',
                            method:'post',
                            data:{
                                orderid:this.lockArray,
                                lockorder:'yes',
                            }
                        }).then((res)=>{
                            if(res.data.res=='success'){
                                //批量锁定后需要直接跳转到已锁定页面
                                this.$store.state.name = 'name3';
                            }else{
                                alert('该单已被锁')
                                return
                            }
                        }).catch((error)=>{
                            console.log(error)
                        })
                    }else if(!f1){
                        return
                    }
                }else{
                    alert('选项为空')
                }
            },
            //全选按钮
            allInp:function(){
                //全选按钮为true后，将所有input按钮置位true
                if(event.target.checked){
                    //下面直接清空id的集合数组，然后再赋值，直接使用ajax得来的数据集合中的各个id
                    //清空原因在于如果某个订单已经被选中，那么再次全选会导致选中两次，所以需要去重，
                    //但是去重需要for循环，干脆直接重置为空，然后再for循环赋值。
                    this.lockArray = [];
                    for(let a=0;a<this.$refs.inputDom.length;a++){
                        this.$refs.inputDom[a].checked = true;
                        this.lockArray.push(this.or[a].id)
                    }
                }else{
                    //当全选按钮为false,将所有按钮置位false
                    for(let a=0;a<this.$refs.inputDom.length;a++){
                        this.$refs.inputDom[a].checked = false;
                    }
                    //下面直接清空id的集合数组，然后再赋值，直接使用ajax得来的数据集合中的各个id
                    this.lockArray = [];
                }
            },
            //单个input在打钩的时候输出id值到集中选地的array
            onlyInputCheck:function(id){
                let alldom = document.getElementById('allcheck');
                if(event.target.checked){
                    this.lockArray.push(id);
                    if(this.lockArray.length==this.or.length){
                        alldom.checked = true;
                    }
                }else{
                    this.lockArray.forEach((item,index)=> {   //删除在ar中添加的cc值
                        this.lockArray[index] == id?this.lockArray.splice(index,1):'';
                    });
                    alldom.checked = false;
                }
            },
            //锁单按钮直接跳转页面
            locKfun:function(table,id){
                let orderid=[id];  //后台需要传入一个数组
                //告诉后台当前是锁单而不是解锁
                let lockorder='yes';
                axios({
                    url:'../bingo/ticking.php?action=locking',
                    method:'post',
                    data:{
                        orderid,
                        lockorder,
                        // see:false
                    }
                }).then((res)=>{
                    if(res.data.res=='success'){
                        this.$store.state.name = 'name3';
                    }else{
                        alert('该单已被锁')
                        window.location.reload(true)
                    }
                }).catch((error)=>{
                    console.log(error)
                })
            },
            //关联锁单按钮
            //重启订票
            replacefun:function(orderid){
                axios({
                    url:'../ticket/manual.php?action=restart',
                    method:'post',
                    data:{
                        orderid
                    }
                }).then(res=>{
                    if(!res.data){
                        window.location.reload(true)
                    }else{
                        alert('该单已经被其他人重启订票')
                    }
                }).catch(error=>console.log(error))

            },
            //重启支付
            repay:function(orderid){
                axios({
                    url:'../ticket/manual.php?action=repay',
                    method:'post',
                    data:{
                        orderid
                    }
                }).then(res=>{
                    if(!res.data){
                        window.location.reload(true)
                    }else{
                        alert('该单已经被其他人重启支付')
                    }
                }).catch(error=>{console.log(error)})
            },
            //双击函数
            dblcli:function(){
                this.dbl = true;
                //清除上个计时器
                clearTimeout(this.clinum)
            },
            //点击订单号，触发游客模式
            locKfuntwo:function(va){
                // this.orderid=[];   重置orderid 以免上次数组里面的值残留其中没有去掉
                window.location.href='../template/artificialDealNew.html?id='+va+'&see=true'+'&_time_=' + allTime;
            },
            //copy函数
            fuzhifun:function(id){
                this.$refs.copy.value = id;
                this.$refs.copy.select();
                document.execCommand('copy',false);
            },
            //日志功能
            orderUp:function(orderid){
                this.clinum = setTimeout(()=>{
                    if(!this.dbl){
                        this.logflag = true;
                        this.$store.state.animaFlag = true;
                        axios({
                            url:'../bingo/ticking.php?action=log',
                            method:'post',
                            data:{
                                orderid
                            }
                        }).then((response)=>{
                            this.$store.state.logar = response.data.list;
                            this.$store.state.animaFlag = false;
                        }).catch((error)=>{
                            console.log(error)
                        })
                    }
                    this.dbl = false
                },200)
                let b = new Date().getTime();
            },
            //分页函数
            //向后转页面 —
            uppage:function(){
                if(this.num>1){
                    this.num -= 1;
                }else if(this.num<1){
                    alert('没有该页码')
                }else{
                    return
                }
                this.axfun(this.num);
            },
            //向前转页面 +
            downpage:function(){
                this.num = Number(this.num); //之前的显示数字其本质为字符串导致无法数字计算
                if(this.num<this.pages){
                    this.num = this.num + 1;
                }else{
                    return
                };
                this.axfun(this.num)
            },
            //直接去某页面
            gotopage:function () {
                let val = this.$refs.num.value;
                if(val > this.pages||val<1){
                    //页数框页码重置
                    this.$refs.num.value = this.num;
                    alert('没有该页码');
                }else{
                    this.num = Math.round(this.num);
                    this.num = val;
                    this.axfun(this.num)
                }
            },
            //直接去首页
            firstpage:function () {
                //如果num已经是第一页了，就不再请求了
                if(this.num == 1){
                    return
                }
                this.num = 1;
                this.axfun(this.num)
            },
            //直接去末尾页
            llastpage:function () {
                //如果已经等于最后已页，就不再请求
                if(this.num == this.pages){
                    return
                }
                this.num = this.pages;
                this.axfun(this.num)
            },
            //跳转后把页面值传入，用来获取要跳转页面的数据，此函数为上面所有跳转函数的通用操作
            axfun:function(page){
                //根据不同的值 来做ajax不同请求 当choose为true;则搜索是开启状态，否则是关闭状态
                //若搜索为真，则直接调用搜索函数，把之前保存的搜索条件传过去；请求搜索后的结果;
                //若搜索为假，则直接调用请求函数，直接拿值；
                if(this.choose){
                    this.chooselock(this.chooseObj,true,page)
                }else{
                    this.inpLock(page);
                }
            },
        },
        filters:{
            yuwei:function (data) {
                if(data){
                    const data01 = data.split('-');
                    return data01[0];
                }
            },
            yuwei2:function (data) {
                if(data){
                    const data01 = data.split('-');
                    return data01[1];
                }
            },
        },
        created(){
            let a = sessionStorage.getItem('payTimeA');
            let b = sessionStorage.getItem('payTimeB');
            this.$store.state.remenberObj.payTime[0] = a;
            this.$store.state.remenberObj.payTime[1] = b;
            if(a){
                this.chooselock(this.$store.state.remenberObj,true,1)
            }else{
                this.inpLock(1);
            }

        }
    });
    //已锁定页面组件
    Vue.component('artificialUnlock',{
        template:'#artificialUnlock',
        data(){
            return{
                //锁定页面的数据承接载体
                orLock:null,
                //总页数
                pages:undefined,
                //起始页数 总是为1
                num:1,
                //  搜索框开关
                searchFlag:false,
                //  条件筛选框开关
                conditionsFlag:false,
            //    input勾选id的集合，当单个input勾选的时候，将其id放入其中，方便批量处理
                orderid:[],
                //    搜索函数是否开启，当搜索开启，此变量会作为true传入，方便翻页的时候判断
                choose:false,
                //    搜索条件存储函数,当搜索开启，此对象将拥有值，方便翻页的时候调用
                chooseObj:null,
            //    个人锁单按钮勾选状态
                aloneChecked:true,
                //    提示没有数据开关
                notDataFlag:false,
                notDataText:undefined,
            }
        },
        methods:{
            //组件首次调用ajax，获取主体table值
            inpLock2:function(page=this.num){
                this.$store.state.animaFlag = true;
                if(this.aloneChecked){
                    axios({
                        url:'../bingo/ticking.php?action=oneman',
                        method:'get',
                    }).then((response)=>{
                        parseFun.call(this,response)
                    }).catch((error)=>{
                        console.log(error)
                    })
                }else{
                    axios({
                        url:'../bingo/ticking.php?action=locklist',
                        method:'post',
                        data:{
                            page
                        }
                    }).then( (response)=>{
                        if(response.data.list.length){
                            parseFun.call(this,response)
                        }else{
                            this.orLock = response.data.list
                            this.notDataText = "暂时没有查询到相关数据，请稍后尝试。";
                            this.notDataFlag = true;
                        }
                    }).catch( (error)=>{
                        this.notDataText = error;
                        this.notDataFlag = true;
                        console.log(error)
                    });
                }
                //解析数据
                function parseFun(response){
                    let orLock = response.data.list;
                    //筛选酷讯时间变红 最晚出票时限标红
                    let leng = orLock.length;
                    for(let i=0;i<leng;i++){
                        //筛选酷讯时间变红
                        if(orLock[i].ticketTable=="酷讯"){
                            let timeyuan = orLock[i].orderTime;
                            let time = timeyuan.match('m');
                            let timeA = undefined;
                            if(time){
                                timeA = (orLock[i].orderTime.match(/[1-9]([0-9]*)m/))[0];
                                timeA = (timeA.replace('m',''))*1;
                                if((timeA-20)>=0){
                                    // 超时
                                    orLock[i].red_time = "red";
                                }else{
                                    //    没超时
                                    orLock[i].red_time = "";
                                }
                            }else if(timeyuan=="刚刚"){
                                orLock[i].red_time = "";
                                //    没超时
                            }else if(timeyuan=="以前"){
                                orLock[i].red_time = "red";
                                //    超时
                            }else{
                                //    超时 h d
                                orLock[i].red_time = "red";
                            }
                            timeyuan = time = timeA = null;
                        }
                        //最晚出票时限标红
                        if(orLock[i].deadline){
                            let time = (new Date()).getTime();
                                let data2 = (new Date(orLock[i].deadline)).getTime();
                                if((data2 - time)<=2*60*60*1000){
                                    orLock[i].data_deallineRed = 1;
                                }
                        }
                    };
                    this.orLock = orLock;
                    leng = null;
                    this.pages = response.data.pages;
                    this.choose = false;
                    this.$store.state.animaFlag = false;
                }
            },
            //搜索框显示隐藏按钮
            searchFlagFun(flag){
                if(flag){
                    this.searchFlag = !this.searchFlag
                }
            },
            //搜索框确认筛选按钮触发函数
            chooselock(obj,choose,page,flag){
                this.$store.state.animaFlag = true;
                //当且只有当搜索条件框的确认筛选按钮按下，才会传obj进来,且choose为true。
                let pagee = undefined;
                if(obj){
                    this.chooseObj = JSON.parse(JSON.stringify(obj));
                }
                page?pagee=page:pagee = 1;
                choose?this.choose=true:this.choose=false;
                obj.page = pagee;
                obj.flag = false;
                axios({
                    method: 'post',
                    url: '../bingo/ticking.php?action=countersign',
                    data:obj
                }).then((response)=>{
                    if(response.data.list.length){
                        this.orLock = response.data.list;
                        this.pages = response.data.pages;
                        this.$store.state.animaFlag = false;
                        this.searchFlagFun(flag)
                    }else{
                        this.orLock = response.data.list;
                        this.notDataText = "暂时没有查询到相关数据，请稍后尝试。";
                        this.notDataFlag = true;
                    }
                }).catch((error)=>{
                    this.notDataText = error;
                    this.notDataFlag = true;
                    console.log(error)
                })
            },
            //条件筛选触发函数
            choosefun:function(choosear){   //条件筛选下满的 确认筛选按钮 会筛选所有打钩的input 放入到choosear里面
                axios({
                    url:'../bingo/ticking.php?action=choose',
                    method:'post',
                    data: choosear,
                }).then((response)=>{
                    this.conditionsFlag = false;
                    this.inpLock2(1)
                }).catch((error)=>{
                    console.log(error)
                })
            },
            //条件筛选关闭函数
            conditionsFun(){
                this.conditionsFlag = !this.conditionsFlag;
            },
            //已经锁单待处理页面的全选按钮 同时在全选的时候给orderid里面添加input,
            allInpLock:function(){
                // var markeLock = document.getElementsByClassName('markeLock');
                let markeLock = this.$refs.inputDom;
                if(event.target.checked){
                    //当全选按钮为true,其input都为置为勾选
                    for(let a=0;a<markeLock.length;a++){
                        markeLock[a].checked = true;
                        //此处去重，防止重复勾选订单，与锁定页面不同，此处使用for循环。而没有直接使用置空。
                        if(!(this.orderid.includes(markeLock[a].dataset.cc))){
                            this.orderid.push(markeLock[a].dataset.cc)
                        }
                    }
                    //同时因为是全选，不能直接使用orLock，因为不一定单是自己的
                    //所以直接用input的属性
                }else{
                    for(let c=0;c<markeLock.length;c++){
                        markeLock[c].checked = false ;
                    };
                    this.orderid = [];
                }
                console.log(this.orderid)
            },
            //批量解锁
            lotSizeLock:function(){
                // let arlockflag = null;
                //用来判断是否有订单被选中，直接通过被选中订单的集合的length来判断
                if(this.orderid.length){
                    axios({
                        method:'post',
                        url:'../bingo/ticking.php?action=locking',
                        data:{
                            orderid:this.orderid,
                            lockorder:'no',
                        }
                    }).then((response)=>{
                        if(response.data.res == 'success'){
                            window.location.reload(true)
                            console.log(this.arLock)
                        }else{
                            alert('解锁失败')
                        }
                    }).catch((error)=>{
                        console.log(error)
                    })
                }else{
                    alert('选项不能为空')
                    window.location.reload(true)
                }
            },
            //锁单待处理页面 只显示个人锁单功能的按钮
            onelockshow:function(){
                this.aloneChecked = !this.aloneChecked;
                this.inpLock2()
            },
            //单个订单的input触发函数 当为true,看是否要勾选全选按钮，当为fals,全选按钮置为false
            addInputId(id){
                let markeLock = this.$refs.inputDom;
                if(event.target.checked){
                    this.orderid.push(id);
                    if(this.orderid.length==markeLock.length){
                        const allInput = document.getElementById('allcheck_lock');
                        allInput.checked = true;
                    }
                }else{
                    this.orderid.forEach((value,index)=>{
                        if(value==id){
                            this.orderid.splice(index,1)
                        }
                    })
                    const allInput = document.getElementById('allcheck_lock');
                    allInput.checked = false;
                }
            },
            //单独解锁按钮函数
            jiesuo:function (orderid) {
                orderid = [orderid];
                axios({
                    url:'../bingo/ticking.php?action=locking',
                    method:'post',
                    data:{
                        orderid,
                        lockorder:'no',
                        // see:false,
                    }
                }).then((response)=>{
                    if(response.data.res == 'success'){
                        window.location.reload(true)
                    }else{
                        alert('解锁失败')
                    }
                }).catch((error)=>{
                    console.log(error)
                });

            },
            //重启订票
            replacefun:function(orderid){
                axios({
                    url:'../ticket/manual.php?action=restart',
                    method:'post',
                    data:{
                        orderid
                    }
                }).then(res=>{
                    if(!res.data){
                        window.location.reload(true)
                    }else{
                        alert('该单已经被其他人重启订票')
                    }
                }).catch(error=>console.log(error))

            },
            //重回函数
            returnOrdFun(orderid,airCompany = 'PN'){
                let url = '../ticket/manual.php?action=pn_replay';
                if(airCompany === 'GS'){
                    url = '../ticket/manual.php?action=gs_replay'
                }
                if(airCompany === 'TV'){
                    url = '../ticket/manual.php?action=tv_replay'
                }
                axios({
                    url:url,
                    method:'post',
                    data:{
                        orderid
                    }
                }).then(res=>{
                    if(!res.data){
                        window.location.reload(true)
                    }else{
                        alert('该单已经被其他人重回')
                    }
                }).catch(error=>console.log(error))
            },
            //重启支付
            repay:function(orderid){
                axios({
                    url:'../ticket/manual.php?action=repay',
                    method:'post',
                    data:{
                        orderid
                    }
                }).then(res=>{
                    if(!res.data){
                        window.location.reload(true)
                    }else{
                        alert('该单已经被其他人重启支付')
                    }
                }).catch(error=>{console.log(error)})
            },
            //绿翼预定函数
            order_green(order_id){
                axios({
                    url:'../ticket/manual.php?action=place_order_green',
                    method:'post',
                    data:{
                        order_id
                    }
                }).then(res=>{
                    if(res.data.code == 100){
                        window.location.reload(true)
                    }else{
                        this.$Message.error({
                            content:res.data.msg,
                            closable:true,
                            duration:10
                        })
                    }
                }).catch(error=>{console.log(error)})
            },
            //绿翼支付
            order_greenSure(order_id,greenuser,ticketNum){
                if(!greenuser){
                    this.$Message.error({
                        content:'没有绿翼账号，无法支付',
                        closable:true,
                        duration:10
                    })
                    return
                }
                if(!ticketNum){
                    this.$Message.error({
                        content:'没有票号，无法支付',
                        closable:true,
                        duration:10
                    })
                    return
                }
                axios({
                    url:'../ticket/manual.php?action=green_pay',
                    method:'post',
                    data:{
                        order_id,
                        greenuser,
                        ticketNum
                    }
                }).then(res=>{
                    if(res.data.code == 100){
                        window.location.reload(true)
                    }else{
                        this.$Message.error({
                            content:res.data.msg,
                            closable:true,
                            duration:10
                        })
                    }
                }).catch(error=>{console.log(error)})
            },
            //换号重启
            changerestart:function(orderid){
                axios({
                    url:'../ticket/manual.php?action=change_restart',
                    method:'post',
                    data:{
                        orderid
                    }
                }).then(res=>{
                    if(!res.data){
                        window.location.reload(true)
                    }else{
                        alert('该单已经被其他人换号重启')
                    }
                }).catch(error=>console.log(error))
            },
            //出票函数
            chupiao:function(id){
                window.location.href='../template/artificialDealNew.html?id='+id+'&_time_=' + allTime;
            },
            //拆分函数
            BreakUpFun:function(id,collection){
                // axios({
                //     method:'post',
                //     url:'../bingo/ticking.php?action=obtain_information',
                //     data:{
                //         orderid:id
                //     }
                // }).then((response)=>{
                //     this.$store.state.splitFlag = true;
                //     this.$store.state.splitObj = response.data.namelist;
                //     this.$store.state.splitObj.totalmoney = collection;
                //     this.$store.state.splitObj.id = id;
                // }).catch((error)=>{
                //     console.log(error)
                // })
                this.$store.state.splitCollection = collection;
                this.$store.state.splitFlag = true;
                this.$store.state.splitId = id
            },
            //回帖函数 （指令函数已去除，但还保留指令，但是不会触发，防不时之需）
            returnNum(cash,ticket,orderid){
                ticket = ticket.replace(/^\s+/,'');
                ticket = ticket.replace(/\s+$/,'');
                store.state.animaFlag = true;
                axios({
                    url:'../ticket/manual.php?action=reply',
                    method:'post',
                    data:{
                        orderid,
                        ticket,
                        cash,
                    }
                }).then((response)=>{
                    store.state.animaFlag = false;
                    if(response.data=='回帖成功'){
                        window.location.reload(true)
                    }else if(response.data=='票号校验失败'){
                        alert('票号校验失败')
                    }
                }).catch((error)=>{
                    console.log(error)
                })
            },
            //拉黑函数
            removeId(username,aircompany_str){
                axios({
                    method:'post',
                    url:'../ticket/manual.php?action=black',
                    data:{
                        username,
                        aircompany_str
                    }
                }).then(res=>{if(res.data)alert('成功')}).catch(err=>{console.log(err)})
            },
            //点击订单号，跳转到处理页面，但是只能看不能操作 游客模式
            locKfuntwo:function(va){
                // this.orderid=[];  //重置orderid 以免上次数组里面的值残留其中没有去掉
                window.location.href='../template/artificialDealNew.html?id='+va+'&see=true'+'&_time_=' + allTime;
            },
            //双击函数
            dblcli:function(){
                this.dbl = true;
                //清除上个计时器
                clearTimeout(this.clinum)
            },
            //copy函数
            fuzhifun:function(id){
                this.$refs.copy.value = id;
                this.$refs.copy.select();
                document.execCommand('copy',false);
            },
            //日志函数
            orderUp:function(orderid){
                this.clinum = setTimeout(()=>{
                    if(!this.dbl){
                        this.logflag = true;
                        this.$store.state.animaFlag = true;
                        axios({
                            url:'../bingo/ticking.php?action=log',
                            method:'post',
                            data:{
                                orderid
                            }
                        }).then((response)=>{
                            //日志显隐是通过logar是否有值来判断的。即logar既是数据载体，也是判断依据
                            this.$store.state.logar = response.data.list;
                            this.$store.state.animaFlag = false;
                        }).catch((error)=>{
                            console.log(error)
                        })
                    }
                    this.dbl = false
                },200)
                let b = new Date().getTime();
            },
            //分页函数
            //向后转页面 —
            uppage:function(){
                if(this.num>1){
                    this.num -= 1;
                }else if(this.num<1){
                    alert('没有该页码')
                }else{
                    return
                }
                this.axfun(this.num);
            },
            //向前转页面 +
            downpage:function(){
                this.num = Number(this.num); //之前的显示数字其本质为字符串导致无法数字计算
                if(this.num<this.pages){
                    this.num = this.num + 1;
                }else{
                    return
                };
                this.axfun(this.num)
            },
            //直接去某页面
            gotopage:function () {
                let val = this.$refs.num.value;
                if(val > this.pages||val<1){
                    //页数框页码重置
                    this.$refs.num.value = this.num;
                    alert('没有该页码');
                }else{
                    this.num = Math.round(this.num);
                    this.num = val;
                    this.axfun(this.num)
                }
            },
            //直接去首页
            firstpage:function () {
                //如果已经等于第一页，就不再请求
                if(this.num == 1){
                    return
                }
                this.num = 1;
                this.axfun(this.num)
            },
            //直接去末尾页
            llastpage:function () {
                //如果已经等于最后已页，就不再请求
                if(this.num == this.pages){
                    return
                }
                this.num = this.pages;
                this.axfun(this.num)
            },
            //跳转后把页面值传入，用来获取要跳转页面的数据，此函数为上面所有跳转函数的通用操作
            axfun:function(page){
                //根据不同的值 来做ajax不同请求 当choose为true;则搜索是开启状态，否则是关闭状态
                //若搜索为真，则直接调用搜索函数，把之前保存的搜索条件传过去；请求搜索后的结果;
                //若搜索为假，则直接调用请求函数，直接拿值；
                if(this.choose){
                    this.chooselock(this.chooseObj,true,page)
                }else{
                    this.inpLock2(page);
                }
            },
        },
        filters:{
            yuwei:function (data) {
                if(data){
                    const data01 = data.split('-');
                    return data01[0];
                }
            },
            yuwei2:function (data) {
                if(data){
                    const data01 = data.split('-');
                    return data01[1];
                }
            },
        },
        created(){
            let a = sessionStorage.getItem('payTimeA');
            let b = sessionStorage.getItem('payTimeB');
            this.$store.state.remenberObj.payTime[0] = a;
            this.$store.state.remenberObj.payTime[1] = b;
            if(a){
                this.chooselock(this.$store.state.remenberObj,true,1)
            }else{
                this.inpLock2(1);
            }
        },
    });
    //异常单页面组件
    Vue.component('abnormalOrder',{
        template:'#abnormalOrder',
        data(){
            return{
                abnormalObj:null,
                pages:undefined,
                num:1,
                notDataFlag:false,
                notDataText:undefined,
                //搜索开关
                abnormalSearchFlag:false,
               //条件筛选弹窗开关
                conditionsFlag:false,
                // 搜索函数对象
                chooseObj:{},
                //个人锁单标志 当点击个人锁单按钮时候，将此值置为true；
                personLockFlag:false,
            }
        },
        filters:{
            is_grabFilter(data){
                switch(data*1){
                    case 1:
                        return '是';
                    case 2:
                        return '否';
                }
            }
        },
        methods:{
            abnormalFun(page = this.num){
                let obj = this.chooseObj;
                let url = '../bingo/ticking.php?action=abnormal_order';
                // let url = 'http://127.0.0.1:3000/refund/f';
                //如果个人锁定按钮触发，则修改地址
                if(this.personLockFlag){
                    url = '../bingo/ticking.php?action=oneman_abnormal_order'
                }
                obj.page = page;
                axios({
                    url:url,
                    // url:'json/artificialAbnormal.json',
                    method:'post',
                    data:obj
                }).then(res=>{
                    if(res.data.list.length){
                        this.abnormalObj = res.data.list;
                        this.pages = res.data.pages;
                    }else{
                        this.abnormalObj = res.data.list;
                        this.notDataFlag = true;
                        this.notDataText = "暂时没有查询到相关数据，请稍后尝试。"
                    }
                }).catch(err=>{
                    this.notDataText = err;
                    this.notDataFlag = true;
                    console.log(err)
                })
            },
            //异常单 处理 按钮
            abnormalDealOrderFun(id){
                window.location.href='../template/artificialDealNew.html?id='+id+'&_time_=' + allTime;
            },
            //批量锁定 全选input
            abnormalAlotOfLock(){
                let inpArr = document.getElementsByClassName('abnormalAloneInp');
                let inpArrLeng = inpArr.length;
                if(event.target.checked){
                    for (let i = 0; i < inpArrLeng; i++) {
                        inpArr[i].checked = true;
                    }
                }else{
                    for (let i = 0; i < inpArrLeng; i++) {
                        inpArr[i].checked = false;
                    }
                }
            },
            //解锁按钮函数
            abnormalUnLock:function (orderid) {
                if(typeof orderid != 'array'){
                    orderid = [orderid];
                }
                axios({
                    url:'../bingo/ticking.php?action=locking',
                    method:'post',
                    data:{
                        orderid,
                        lockorder:'no',
                    }
                }).then((response)=>{
                    if(response.data.res == 'success'){
                        window.location.reload(true)
                    }else{
                        alert('解锁失败')
                    }
                }).catch((error)=>{
                    console.log(error)
                });

            },
            //批量解锁
            abnormalAlotOfUnlockFun(){
                let inpArr = document.getElementsByClassName('abnormalAloneInp');
                let inpArrLeng = inpArr.length;
                let ordidArr = [];
                for (let i = 0; i < inpArrLeng; i++) {
                    if(inpArr[i].checked){
                        ordidArr.push(inpArr[i].dataset.id)
                    }
                };
                if(ordidArr.length){
                    this.abnormalUnLock(ordidArr);
                }else{
                    this.$Message.error({
                        content: '请至少选择一条订单',
                        duration: 10,
                        background:true,
                        closable: true
                    });
                }
            },
            //个人锁单按钮函数
            abnormalAloneLockFun(){
                this.personLockFlag = true;
                this.num = 1;
                this.abnormalFun()
            },
            //单条单input按钮
            abnormalOrderAloneInp(){
                //获取全选按钮
                let abnormalAlotOfInputId = document.getElementById('abnormalAlotOfInputId');
                //获取所有的单独input按钮
                let inpArr = document.getElementsByClassName('abnormalAloneInp');
                let inpArrLeng = inpArr.length;
                let ordidArr = 0;
                if(event.target.checked){
                    for (let i = 0; i < inpArrLeng; i++) {
                        if(inpArr[i].checked){
                            ordidArr +=1
                        }
                    };
                    if(ordidArr === inpArrLeng){
                        abnormalAlotOfInputId.checked = true
                    }
                }else{
                    abnormalAlotOfInputId.checked = false
                }
            },
           // 搜索开关函数
            abnormalSearchFlagFun(){
                this.abnormalSearchFlag = !this.abnormalSearchFlag
            },
            //搜索框确认筛选按钮触发函数
            chooselock(obj){
                // this.$store.state.animaFlag = true;
                //当且只有当搜索条件框的确认筛选按钮按下，才会传obj进来,且choose为true。
                if(obj){
                    this.chooseObj = JSON.parse(JSON.stringify(obj));
                }
                this.num = 1;
                this.abnormalFun();
                // obj.flag = false;
                // axios({
                //     url: '../bingo/ticking.php?action=countersign',
                //     method:'post',
                //     data:obj
                // }).then((response)=>{
                //     /*if(response.data.list.length){
                //         this.orLock = response.data.list;
                //         this.pages = response.data.pages;
                //         this.$store.state.animaFlag = false;
                //         this.searchFlagFun(flag)
                //     }else{
                //         this.notDataText = "暂时没有查询到相关数据，请稍后尝试。";
                //         this.notDataFlag = true;
                //     }*/
                // }).catch((error)=>{
                //     this.notDataText = error;
                //     this.notDataFlag = true;
                //     console.log(error)
                // })
            },
            //条件筛选关闭函数
            conditionsFun(){
                this.conditionsFlag = !this.conditionsFlag;
            },
           //分页函数
            //向后转页面 —
            uppage:function(){
                if(this.num>1){
                    this.num -= 1;
                }else if(this.num<1){
                    alert('没有该页码')
                }else{
                    return
                }
                this.axfun(this.num);
            },
            //向前转页面 +
            downpage:function(){
                this.num = Number(this.num); //之前的显示数字其本质为字符串导致无法数字计算
                if(this.num<this.pages){
                    this.num = this.num + 1;
                }else{
                    return
                };
                this.axfun(this.num)
            },
            //直接去某页面
            gotopage:function () {
                let val = this.$refs.num.value;
                if(val > this.pages||val<1){
                    //页数框页码重置
                    this.$refs.num.value = this.num;
                    alert('没有该页码');
                }else{
                    this.num = Math.round(this.num);
                    this.num = val;
                    this.axfun(this.num)
                }
            },
            //直接去首页
            firstpage:function () {
                //如果num已经是第一页了，就不再请求了
                if(this.num == 1){
                    return
                }
                this.num = 1;
                this.axfun(this.num)
            },
            //直接去末尾页
            llastpage:function () {
                //如果已经等于最后已页，就不再请求
                if(this.num == this.pages){
                    return
                }
                this.num = this.pages;
                this.axfun(this.num)
            },
            //跳转后把页面值传入，用来获取要跳转页面的数据，此函数为上面所有跳转函数的通用操作
            axfun:function(page){
                this.abnormalFun(page)
            },
        },
        created(){
            this.abnormalFun(1)
        },
    });
    //客服异常组件
    Vue.component('server',{
        template:'#server',
        data(){
            return{
                //自动出票中数据承接主体
                serverObj:null,
                //    初始num总为1 用与翻页框中的页码数
                num:1,
                //    总页数
                pages:1,
            //    当前客户端的用户人，用于判断处理按钮是否显隐
                person:undefined,
            //    提示没有数据开关
                notDataFlag:false,
                //提示没有数据的文本内容
                notDataText:undefined,
            }
        },
        methods:{
            //初始化函数拿取数据
            serverDateFun(page){
                this.$store.state.animaFlag = true;
                axios({
                    method:'post',
                    url:'../bingo/abnormal_order.php?action=UnexpectOrder',
                    data:{
                        page
                    }
                }).then((res)=>{
                    if(res.data.list.length){
                        this.serverObj = res.data.list;
                        this.pages = res.data.pages;
                        // this.person = res.data.preson;
                        this.person = res.data.UserInfo.name;
                        //初始化请求让条件筛选ajax函数开关为false。
                        // this.choose = false;
                        this.$store.state.animaFlag = false;
                    }else{
                        this.serverObj = res.data.list;
                        this.notDataText = "暂时没有查询到相关数据，请稍后尝试。";
                        this.notDataFlag = true;
                    }
                }).catch( (error)=> {
                    this.notDataText = error;
                    this.notDataFlag = true;
                    console.log(error)
                });
            },
            //将单置为异常单,同时调取函数更改锁单人名字
            abnormalServerfun(orderid){
                axios({
                    method:'post',
                    url:'../ticket/manual.php?action=process',
                    data:{
                        orderid
                    }
                }).then( (res)=>{
                    window.location.href='../template/artificialDealNew.html?id='+orderid+'&server=true'+'&_time_=' + allTime;
                }).catch( (error)=> {
                    console.log(error)
                });
            },
            //分页函数
            //向后转页面 —
            uppage:function(){
                if(this.num>1){
                    this.num -= 1;
                }else if(this.num<1){
                    alert('没有该页码')
                }else{
                    return
                }
                this.axfun(this.num);
            },
            //向前转页面 +
            downpage:function(){
                this.num = Number(this.num); //之前的显示数字其本质为字符串导致无法数字计算
                if(this.num<this.pages){
                    this.num = this.num + 1;
                }else{
                    return
                };
                this.axfun(this.num)
            },
            //直接去某页面
            gotopage:function () {
                let val = this.$refs.num.value;
                if(val > this.pages||val<1){
                    //页数框页码重置
                    this.$refs.num.value = this.num;
                    alert('没有该页码');
                }else{
                    this.num = Math.round(this.num);
                    this.num = val;
                    this.axfun(this.num)
                }
            },
            //直接去首页
            firstpage:function () {
                //如果num已经是第一页了，就不再请求了
                if(this.num == 1){
                    return
                }
                this.num = 1;
                this.axfun(this.num)
            },
            //直接去末尾页
            llastpage:function () {
                //如果已经等于最后已页，就不再请求
                if(this.num == this.pages){
                    return
                }
                this.num = this.pages;
                this.axfun(this.num)
            },
            //跳转后把页面值传入，用来获取要跳转页面的数据，此函数为上面所有跳转函数的通用操作
            axfun:function(page){
                this.serverDateFun(page)
            },
        },
        created(){
            this.serverDateFun(1)
        }
    });


    // 记忆筛选组件
    Vue.component('conditions',{
        template:'#conditions',
        props:[],
        computed:{
        },
        data(){
            return{
                //单选默认
                ticketTime:'1',
                //~~~航司~~~
                //航司数据
                airlineIndeterminate: false,
                //航司全选按钮
                airlineCheckAll:false,
                //航司数组
                // airline:['3U', '9C','A6','BK','CA','CZ','DZ',
                //          'EU','G5','GJ','GX','GY','JR','KN',
                //          'KY','LT','MF','NS','PN','QW','RY',
                //          'SC','TV','UQ','ZH'],
                airline:[],
                //选择后的航司值
                airlineGroup:[],
                //~~~平台~~~
                tableIndeterminate:false,
                tableCheckAll:false,
                //平台数组
                tableGroup:['xss','xsg','ttr','携程','淘宝9C','517NA','酷讯',
                    '同程','淘宝B平台','平安淘宝','携程团队','八千翼','pai','携程klf','同程klf','携程直连'],
                // tableGroup:['tts向上商旅','tts向上优选','tts天天航服','tb携程','淘宝','517na','酷讯',
                //     '同程','淘宝B平台供应','TB','携程团队'],
                //被选中后的平台
                tableCheckGroup:[],
                //最高全选按钮
                // AllIndeterminate:false,
                // AllValue:false,
                // AllGroup:[],
            }
        },
        methods:{
            //关闭开启条件筛选框
            conditionsFun(){
                this.$emit('conditionsfun')
            },
            //航司函数
            //函数是iview的样式函数喝自己写的逻辑函数结合。需要参照iview的多选按钮样式函数来解读
            airlineCheckAllFun(){
                if (this.airlineIndeterminate) {
                    this.airlineCheckAll = false;
                } else {
                    this.airlineCheckAll = !this.airlineCheckAll;
                }
                this.airlineIndeterminate = false;

                if (this.airlineCheckAll) {
                    this.airlineGroup = this.airline;
                } else {
                    this.airlineGroup = [];
                }
            },
            airlineGroupChange (data) {
                if (data.length === this.airline.length) {
                    this.airlineIndeterminate = false;
                    this.airlineCheckAll = true;
                } else if (data.length > 0) {
                    this.airlineIndeterminate = true;
                    this.airlineCheckAll = false;
                } else {
                    this.airlineIndeterminate = false;
                    this.airlineCheckAll = false;
                }
            },
            //平台函数
            tableCheckAllFun(){
                if (this.tableIndeterminate) {
                    this.tableCheckAll = false;
                } else {
                    this.tableCheckAll = !this.tableCheckAll;
                }
                this.tableIndeterminate = false;

                if (this.tableCheckAll) {
                    this.tableCheckGroup = this.tableGroup;
                } else {
                    this.tableCheckGroup = [];
                }
            },
            tableCheckGroupChange(data){
                if (data.length === this.tableGroup.length) {
                    this.tableIndeterminate = false;
                    this.tableCheckAll = true;
                } else if (data.length > 0) {
                    this.tableIndeterminate = true;
                    this.tableCheckAll = false;
                } else {
                    this.tableIndeterminate = false;
                    this.tableCheckAll = false;
                }
            },
            //    全选 暂时没做
            AllCheckGroupFun(data){
                if (data.length === this.tableGroup.length+this.airline.length) {
                    // this.tableIndeterminate = false;
                    this.tableCheckAll = true;
                    this.AllGroup=this.tableGroup
                } else if (data.length > 0) {
                    // this.tableIndeterminate = true;
                    this.tableCheckAll = false;
                } else {
                    // this.tableIndeterminate = false;
                    this.tableCheckAll = false;
                }
            },
            //    条件筛选确定筛选按钮
            choosefun(){
                let tableCheckGroupA = [];
                let inde = [];
                for(let a=0,leng=this.tableCheckGroup.length;a<leng;a++){
                    if(this.tableCheckGroup[a]=='xss'){
                        tableCheckGroupA.push(1);
                        inde.push(a)
                    }else if(this.tableCheckGroup[a]=='xsg') {
                        tableCheckGroupA.push(2);
                        inde.push(a)
                    }else if(this.tableCheckGroup[a]=='ttr'){
                        tableCheckGroupA.push(3)
                        inde.push(a)
                    }
                };
                // this.tableCheckGroup.forEach((ele,index)=>{
                //     if(ele=='xss'||ele=='xsg'||ele=='ttr'){
                //         this.tableCheckGroup.splice(index)
                //     }
                // })
                // for(let a=0;a<inde.length;a++){
                //     this.tableCheckGroup.splice(inde[a])
                //     console.log(inde[a])
                // }
                // let tableCheckGroupB = [...this.tableCheckGroup];
                let tableCheckGroupB = JSON.parse(JSON.stringify(this.tableCheckGroup));
                let c = [];
                tableCheckGroupB.filter((ele,index)=>{
                    if(ele!='xss'&&ele!='xsg'&&ele!='ttr'){
                        c.push(tableCheckGroupB[index])
                    }
                })
                // tableCheckGroupB = []
                // for(let a=0;a<tableCheckGroupB.length;a++){
                //     let ele = tableCheckGroupB[a];
                //     if(ele=='xss'||ele=='xsg'||ele=='ttr'){
                //         tableCheckGroupB.splice(a);
                //     }
                // }
                // console.log(tableCheckGroupB)
                // console.log(c)
                let choosear = [[this.ticketTime],this.airlineGroup,tableCheckGroupA,c];
                // console.log(choosear)
                this.$emit('choosefun',choosear);
            }
        },
        created(){
            axios({
                url:'../bingo/ticking.php?action=confirmation_screening',
                post:'get'
            }).then(res=>{
                this.airline=res.data['0'];
                if(this.ticketTime) {
                    this.ticketTime = res.data.s_condition;
                }
                let ar1 = [];
                if(res.data.s_airways){
                    ar1 = res.data.s_airways.replace(/'/g,'').split((/,/));
                }
                let ar2 = [];
                if(res.data.s_platform){
                    ar2 = res.data.s_platform.replace(/'/g,'').split(/,/);
                }
                //选择航司的数组
                this.airlineGroup = ar1;
                //    选择平台
                this.tableCheckGroup = ar2;
                ar1 = ar2 = null;
            }).catch(err=>console.log(err))
        },
        updated(){}
    });
    //日志组件
    Vue.component('logDom',{
        template:'#logDom',
        data(){
            return{
                columns1: [
                    {
                        title: '操作人',
                        key: 'name',
                    },
                    {
                        title: '时间',
                        key: 'time',
                    },
                    {
                        title: '操作',
                        key: 'note',
                        width:300,
                    }
                ],
                logSelfFlag:true,
            }
        },
        watch:{

        },
        computed:{
            logar(){
                return this.$store.state.logar
            },
        },
        methods:{
            closeLog(){
                this.logSelfFlag = false;
                this.$store.state.logar = null;
            }
        },
        created(){
            this.logSelfFlag = true;
        }
    });
    //搜索框组件
    Vue.component('choose',{
        template:'#choosetem',
        data(){
            return{
                aircompany_str:null,//航司
                payTime:[], //支付日期
                flyTime:[], //起飞日期
                ticketTable:null,//平台选择
                bigNumber:null, //大pnr
                smartNumber:null,//小pnr
                big:null,//换大pnr
                smart:null, //换小pnr
                man:null, //乘客姓名
                policyCode:null, //政策代码
                flight:null, //航班号
                id:null,//系统订单号
                platformOrder:null,//平台订单号
                //是否要调用格式转换
                changeFlmat:true,
            }
        },
        computed:{
            name(){
                return this.$store.state.name;
            }
        },
        methods:{
            //清空支付日期
            flyClearFun(){
                sessionStorage.setItem('payTimeA','');
                sessionStorage.setItem('payTimeB','');
            },
            //确认筛选按钮的函数，更新为筛选后的数据
            chooselock:function () {
                if(this.changeFlmat){
                    let a = new Date();
                    this.payTime[0] = a.toLocaleDateString(this.payTime[0]).replace(/\//g,'-');
                    this.payTime[1] = a.toLocaleDateString(this.payTime[1]).replace(/\//g,'-');
                    this.changeFlmat = false;
                }

                let obj = {
                    aircompany_str:this.aircompany_str,
                    payTime:this.payTime,
                    flyTime:this.flyTime,
                    ticketTable:this.ticketTable,
                    bigNumber:this.bigNumber,
                    smartNumber:this.smartNumber,
                    big:this.big,
                    smart:this.smart,
                    man:this.man,
                    policyCode:this.policyCode,
                    flight:this.flight,
                    id:this.id,
                    platformOrder:this.platformOrder,
                //    还有个判断是否在锁定页面的开关？
                };
                this.$emit('chooselock',obj,true);
                a=obj=null;
            },
            //支付日期过滤
            payTimeFun(data){
                this.payTime[0] = data[0];
                this.payTime[1] = data[1];
                // console.log(this.payTime[0],this.payTime[1])
                // console.log(sessionStorage.getItem('payTimeA'))
                sessionStorage.setItem('payTimeA',this.payTime[0]);
                sessionStorage.setItem('payTimeB',this.payTime[1]);
                // console.log(sessionStorage.getItem('payTimeA'))
                this.changeFlmat = false;
            },
            //起飞日期过滤
            flyTimeFun(data){
                this.flyTime[0] = data[0];
                this.flyTime[1] = data[1];
            },
            //条件筛选按钮触发
            condition(){
                this.$emit('conditionsfun')
            },
        },
        created(){
            this.payTime[0] = sessionStorage.getItem('payTimeA');
            this.payTime[1] = sessionStorage.getItem('payTimeB');
            if(!this.payTime[0]) {
                let time = new Date;
                let b = time.toLocaleDateString().replace(/\//g,'-');
                let a = (time.toLocaleDateString(time.setDate(time.getDate()-1))).replace(/\//g,'-');
                this.payTime[0] = a;
                this.payTime[1] = b;
                time=a=b=null;
            }
        },
        updated(){},
        mounted(){}
    });
    //拆分组件
    Vue.component('split',{
        template:'#split',
        data(){
            return{
                //个人拆分的数据对象
                personObj:undefined,
                //存储拆分被勾选的项
                indexarr:[],
            //    拆分总金额
                totalmoney:undefined,
            //    拆分确定按钮仅仅点一次效果
                splitButtonFlag:false,
                //拆分按钮文字
                text:'确认拆分乘机人'
            }
        },
        computed:{
            //拆分开关
            splitFlag(){
                return this.$store.state.splitFlag
            },
            //被拆的订单id
            splitId:{
                get:function(){
                    return  this.$store.state.splitId
                },
                set:function(data){
                    return  this.$store.state.splitId = data
                }
            }
        },
        methods:{
            splitePerson(){
                axios({
                    method:'post',
                    url:'../bingo/ticking.php?action=obtain_information',
                    data:{
                        orderid:this.splitId,
                    }
                }).then((response)=>{
                    this.splitButtonFlag = false;
                    //乘机人信息载体
                    this.personObj = response.data.namelist;
                    //总金额从store里面获取
                    //之所以这样写，而不是前面BreakUpFun赋值，是因为前面splitobj不是对象，此时才是对象
                    this.totalmoney = this.$store.state.splitCollection;
                    // this.$store.state.splitObj.id = this.splitId;
                    //当前拆单的id
                    this.personObj.id = this.splitId;
                    for(let a=0;a<this.personObj.length;a++){
                        this.personObj[a].che = 0;
                        this.personObj[a].collection = '';
                    }
                }).catch((error)=>{
                    console.log(error)
                })

            },
            //存储打钩input的index 该index为dom的index 正好与input唯一对应
            //该方法仅仅是用来在点击确认时候是否有勾选项，至于勾选了谁，拆分这里
            //使用的是v-model,触发input的checked的true或者false
            splitAloneCheck:function(ind){
                if(event.target.checked == true){
                    this.indexarr.push(ind)
                }else{
                    this.indexarr.forEach((value,index,key)=>{
                        if(ind == value) {
                            this.indexarr.splice(index,1)
                        }
                    })
                }
            },
            //确认拆分订单 同时会把打钩的input拿来打包
            splitorderFun:function(flag){
                let cash = 0;
                //保证拆分按钮只会使用一次
                if(flag){
                    return
                }
                //用与确认金额和总金额是否对应
                for(let a=0,leng=this.personObj.length;a<leng;a++){
                    cash = calc.add(this.personObj[a].collection,cash);
                    if(this.personObj[a].che){
                        this.personObj[a].che = 1;
                    }
                }
                //用与
                if(this.totalmoney==cash&&this.indexarr.length){
                    this.text = '正在拆分中';
                    this.splitButtonFlag = true;
                    axios({
                        method:'post',
                        url:'../bingo/ticking.php?action=split_order',
                        data:{
                            //乘客信息数组
                            namelist:this.personObj,
                            //该单的单号
                            orderid:this.splitId,
                        }
                    }).then((response)=>{
                        if(response.data == 'success'){
                            window.location.reload(true);
                            this.$store.state.name = 'name3';
                        }else{
                            alert('拆分失败');
                        }
                    }).catch((error)=>{
                        alert(error);
                    })
                }else{
                    alert('金额不对或必须勾选一项');
                    this.$refs.splitcheck.forEach((va,index)=>{
                        this.$refs.splitcheck[index].checked = false
                    });
                    this.indexarr = [];
                }
            },
            //拆分弹窗的隐藏于显示
            BreakUpFunClose:function () {
                // this.splitFlag = false;
                this.$store.state.splitFlag = false;
            },
        },
        created(){
            this.splitePerson();
        }
    });
    //暂无数据展示栏
    Vue.component('notData',{
        template:'#notData',
        props:['not-data-text'],
        data(){
            return{}
        },
    })
    //store
    let store = new Vuex.Store({
        state:{
            name:'name2',
            //日志内容存储载体
            logar:null,
            //缓冲动画开关
            animaFlag:false,
            //拆分弹窗开关
            splitFlag:false,
            // //拆分数据载体
            // splitObj:null,
            //拆分id
            splitId:undefined,
        //    拆分需要用的总金额
            splitCollection:undefined,
        //    记忆查找功能对象
            remenberObj:{
                aircompany_str:null,
                payTime:[],
                flyTime:null,
                ticketTable:null,
                bigNumber:null,
                smartNumber:null,
                big:null,
                smart:null,
                man:null,
                policyCode:null,
                flight:null,
                id:null,
                platformOrder:null,
                //    还有个判断是否在锁定页面的开关？
            }
        },
        mutations:{
            changNameFun(name){
                this.name = name
            }
        }
    });
    let Dom = new Vue({
        el:'#artificialDom',
        store,
        data:{
            // animaFlag:false
        },
        computed:{
            name:{
                get:function () {
                    return this.$store.state.name;
                },
                set:function (data) {
                    this.$store.state.name = data
                }
            },
            animaFlag(){
                return this.$store.state.animaFlag;
            },
            splitFlag(){
                return this.$store.state.splitFlag
            },
            logar(){
                return this.$store.state.logar
            },
        },
        methods:{
            tabChange(data){
                // console.log(data)
                // this.$store.state.name = '';
                // this.$store.commit('changNameFun',data)
            }
        },
        mounted(){

        }
    });
</script>
</body>
</html>